"use strict";

var diybucket = {}; // our global variable
diybucket.linearRegression = {};
var diylr = diybucket.linearRegression;
diylr.alpha = 0.0003;
diylr.theta = [0, 0];
diylr.iterations = 0;

diybucket.data = [{ x: 5, y: 4 }, { x: 15, y: 20 }, { x: 30, y: 45 }, { x: 12, y: 15 }, { x: 60, y: 70 }, { x: 55, y: 69 }, { x: 29, y: 30 }, { x: 44, y: 40 }, { x: 78, y: 89 }, { x: 90, y: 95 }, { x: 69, y: 77 }, { x: 74, y: 74 }, { x: 60, y: 66 }, { x: 100, y: 96 }];

// SCATTER PLOT SETUP

diybucket.scatterplot = {}; // diybucket for the scatter plot
var diysp = diybucket.scatterplot; // convenience variable
diysp.margin = { top: 20, right: 20, bottom: 30, left: 40 };
diysp.width = 600 - diysp.margin.left - diysp.margin.right;
diysp.height = 313 - diysp.margin.top - diysp.margin.bottom;

// setup x
diysp.xValue = function (d) {
  return d.x;
}; // data -> value
diysp.xScale = d3.scale.linear().domain([0, 100]).range([0, diysp.width]); // value -> didiysplay
diysp.xMap = function (d) {
  return diysp.xScale(diysp.xValue(d));
}; // data -> didiysplay
diysp.xAxis = d3.svg.axis().scale(diysp.xScale).orient("bottom");

// setup y
diysp.yValue = function (d) {
  return d.y;
}; // data -> value
diysp.yScale = d3.scale.linear().domain([0, 100]).range([diysp.height, 0]); // value -> didiysplay
diysp.yMap = function (d) {
  return diysp.yScale(diysp.yValue(d));
}; // data -> didiysplay
diysp.yAxis = d3.svg.axis().scale(diysp.yScale).orient("left");

// setup color scale
diysp.colorScale = d3.scale.linear().range(["hsl(20,90%,40%)", "hsl(180,60%,40%)"]);

// add graph canvas to #scatterplot div
diysp.svg = d3.select("#diyscatterplot").append("svg").attr("width", diysp.width + diysp.margin.left + diysp.margin.right).attr("height", diysp.height + diysp.margin.bottom + diysp.margin.top).append("g").attr("transform", "translate(" + diysp.margin.left + "," + diysp.margin.top + ")");

// x-axis
diysp.svg.append("g").attr({
  "class": "x axis",
  transform: "translate(0," + diysp.height + ")"
}).call(diysp.xAxis).append("text").attr({
  "class": "label",
  x: diysp.width,
  y: -6
}).style("text-anchor", "end").text("x");

// y-axis
diysp.svg.append("g").attr("class", "y axis").call(diysp.yAxis).append("text").attr({
  "class": "label",
  transform: "rotate(-90)",
  y: 6,
  dy: ".71em"
}).style("text-anchor", "end").text("y");

// CHANGES TO SCATTER PLOT
diybucket.update = function () {

  // buffer added to data domain to prevent overlapping axis
  //  diysp.xScale.domain([d3.min(data,diysp.xValue)-1, d3.max(data,diysp.xValue)+1]);
  //  diysp.yScale.domain([d3.min(data,diysp.yValue)-1, d3.max(data,diysp.yValue)+1]);
  diysp.xScale.domain([0, 100]);
  diysp.yScale.domain([0, 100]);
  diysp.colorScale.domain([d3.min(diybucket.data, diysp.yValue) - 1, d3.max(diybucket.data, diysp.yValue) + 1]).nice();

  // update axes
  diysp.svg.select(".x.axis").transition().duration(1000).call(diysp.xAxis);

  diysp.svg.select(".y.axis").transition().duration(1000).call(diysp.yAxis);

  // dots
  var dots = diysp.svg.selectAll(".dot").data(diybucket.data).attr({
    "class": "dot",
    r: 3.5,
    cx: diysp.xMap,
    cy: diysp.yMap
  }).style("fill", function (d) {
    return diysp.colorScale(diysp.yValue(d));
  });

  dots.enter().append("circle").attr({
    "class": "dot",
    r: 3.5,
    cx: diysp.xMap,
    cy: diysp.yMap
  }).style("fill", function (d) {
    return diysp.colorScale(diysp.yValue(d));
  }).on("click", function (d, i) {
    if (diybucket.data.length > 2) {
      diybucket.data.splice(i, 1);
    } else {
      alert("hey man, not cool. \n\neveryone knows there have to exist at least two points for a line to exist.");
    }
    diybucket.update();
  });

  dots.exit().remove();

  // calculate theta values using gradient descent
  // begins with a "guess", which is theta_0 = 0, theta_1 = 0
  // a.k.a. - the x-axis (y = 0 * x + 0 => y = 0)

  diylr.alpha = diylr.alpha || 0.0003, diylr.theta = diylr.theta || [0, 0], diylr.jHistory = [], diylr.thetaHistory = [];
  var i = 0,
      difference = function difference() {
    if (i < 150000) {
      return diylr.jHistory[i - 2] ? diylr.jHistory[i - 2] - diylr.jHistory[i - 1] : 1;
    }
    return 0;
  };

  do {
    diylr.theta = gradientDescent(diybucket.data, diylr.alpha, diylr.theta);
    diylr.jHistory.push(J(diybucket.data, diylr.theta));
    diylr.thetaHistory.push(diylr.theta);
    i++;
  } while (difference() > 0.0001);

  diylr.iterations = i;

  var maxX = d3.max(diybucket.data, diysp.xValue);
  // var minX = d3.min(diybucket.data,diysp.xValue);
  var minX = 0;
  diysp.svg.selectAll("line").remove();
  var lineOfBestFit = diysp.svg.append("line").attr({
    x1: diysp.xScale(minX),
    y1: diysp.yScale(minX * diylr.theta[1] + diylr.theta[0]),
    x2: diysp.xScale(maxX),
    y2: diysp.yScale(maxX * diylr.theta[1] + diylr.theta[0]),
    "stroke": "#1CDEC4",
    "stroke-width": 2
  });

  // display the equation for the line of best fit
  var docFrag = document.createDocumentFragment();
  var eq = document.createElement("P");
  docFrag.appendChild(eq);
  var eqText = document.createTextNode("y = " + diylr.theta[1].toPrecision(3) + "x + " + diylr.theta[0].toPrecision(3));
  eq.appendChild(eqText);
  $("#diyequation").empty();
  $("#diyequation").append(docFrag);

  var docFrag2 = document.createDocumentFragment();
  var numIters = document.createElement("P");
  docFrag2.appendChild(numIters);
  var numItersText = document.createTextNode("number of iterations: " + diylr.iterations);
  numIters.appendChild(numItersText);
  $("#num-iters").empty();
  $("#num-iters").append(docFrag2);
};
diybucket.update();

// adds a new, randomly generated datum to graph
d3.select("#diyadd").on("click", function () {
  var newDot = {};
  newDot.x = Math.floor(Math.random() * 100);
  newDot.y = Math.floor(Math.random() * 100);
  diybucket.data.push(newDot);
  diybucket.update();
});

$("#diyrun").on("click", function (event) {
  var t = [],
      a = parseFloat($("#alpha").val());
  t[0] = parseFloat($("#b").val());
  t[1] = parseFloat($("#m").val());
  if (typeof t[0] === "number" && typeof t[1] === "number" && typeof a === "number" && !isNaN(t[0]) && !isNaN(t[1]) && !isNaN(a)) {
    diylr.theta[0] = t[0];
    diylr.theta[1] = t[1];
    diylr.alpha = a;
    diybucket.update();
  } else {
    alert("values must each be a number.");
  }
  event.preventDefault();
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNyYy9qcy9kaXlzY2F0dGVycGxvdC5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLElBQUksU0FBUyxHQUFHLEVBQUUsQ0FBQztBQUNuQixTQUFTLENBQUMsZ0JBQWdCLEdBQUcsRUFBRSxDQUFDO0FBQ2hDLElBQUksS0FBSyxHQUFHLFNBQVMsQ0FBQyxnQkFBZ0IsQ0FBQztBQUN2QyxLQUFLLENBQUMsS0FBSyxHQUFHLE1BQU0sQ0FBQztBQUNyQixLQUFLLENBQUMsS0FBSyxHQUFHLENBQUMsQ0FBQyxFQUFDLENBQUMsQ0FBQyxDQUFDO0FBQ3BCLEtBQUssQ0FBQyxVQUFVLEdBQUcsQ0FBQyxDQUFDOztBQUVyQixTQUFTLENBQUMsSUFBSSxHQUFHLENBQ2YsRUFBRSxDQUFDLEVBQUcsQ0FBQyxFQUFLLENBQUMsRUFBRyxDQUFDLEVBQUUsRUFDbkIsRUFBRSxDQUFDLEVBQUcsRUFBRSxFQUFJLENBQUMsRUFBRyxFQUFFLEVBQUMsRUFDbkIsRUFBRSxDQUFDLEVBQUcsRUFBRSxFQUFJLENBQUMsRUFBRyxFQUFFLEVBQUMsRUFDbkIsRUFBRSxDQUFDLEVBQUcsRUFBRSxFQUFJLENBQUMsRUFBRyxFQUFFLEVBQUMsRUFDbkIsRUFBRSxDQUFDLEVBQUcsRUFBRSxFQUFJLENBQUMsRUFBRyxFQUFFLEVBQUMsRUFDbkIsRUFBRSxDQUFDLEVBQUcsRUFBRSxFQUFJLENBQUMsRUFBRyxFQUFFLEVBQUMsRUFDbkIsRUFBRSxDQUFDLEVBQUcsRUFBRSxFQUFJLENBQUMsRUFBRyxFQUFFLEVBQUMsRUFDbkIsRUFBRSxDQUFDLEVBQUcsRUFBRSxFQUFJLENBQUMsRUFBRyxFQUFFLEVBQUMsRUFDbkIsRUFBRSxDQUFDLEVBQUcsRUFBRSxFQUFJLENBQUMsRUFBRyxFQUFFLEVBQUMsRUFDbkIsRUFBRSxDQUFDLEVBQUcsRUFBRSxFQUFJLENBQUMsRUFBRyxFQUFFLEVBQUMsRUFDbkIsRUFBRSxDQUFDLEVBQUcsRUFBRSxFQUFJLENBQUMsRUFBRyxFQUFFLEVBQUMsRUFDbkIsRUFBRSxDQUFDLEVBQUcsRUFBRSxFQUFJLENBQUMsRUFBRyxFQUFFLEVBQUMsRUFDbkIsRUFBRSxDQUFDLEVBQUcsRUFBRSxFQUFJLENBQUMsRUFBRyxFQUFFLEVBQUMsRUFDbkIsRUFBRSxDQUFDLEVBQUcsR0FBRyxFQUFHLENBQUMsRUFBRyxFQUFFLEVBQUMsQ0FDcEIsQ0FBQzs7OztBQUlGLFNBQVMsQ0FBQyxXQUFXLEdBQUcsRUFBRSxDQUFDO0FBQzNCLElBQUksS0FBSyxHQUFHLFNBQVMsQ0FBQyxXQUFXLENBQUM7QUFDbEMsS0FBSyxDQUFDLE1BQU0sR0FBRyxFQUFFLEdBQUcsRUFBRSxFQUFFLEVBQUUsS0FBSyxFQUFFLEVBQUUsRUFBRSxNQUFNLEVBQUUsRUFBRSxFQUFFLElBQUksRUFBRSxFQUFFLEVBQUUsQ0FBQztBQUM1RCxLQUFLLENBQUMsS0FBSyxHQUFHLEdBQUcsR0FBRyxLQUFLLENBQUMsTUFBTSxDQUFDLElBQUksR0FBRyxLQUFLLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQztBQUMzRCxLQUFLLENBQUMsTUFBTSxHQUFFLEdBQUcsR0FBRyxLQUFLLENBQUMsTUFBTSxDQUFDLEdBQUcsR0FBRyxLQUFLLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQzs7O0FBRzNELEtBQUssQ0FBQyxNQUFNLEdBQUcsVUFBUyxDQUFDLEVBQUU7QUFBRSxTQUFPLENBQUMsQ0FBQyxDQUFDLENBQUM7Q0FBRSxDQUFDO0FBQzNDLEtBQUssQ0FBQyxNQUFNLEdBQUcsRUFBRSxDQUFDLEtBQUssQ0FBQyxNQUFNLEVBQUUsQ0FDN0IsTUFBTSxDQUFDLENBQUMsQ0FBQyxFQUFDLEdBQUcsQ0FBQyxDQUFDLENBQ2YsS0FBSyxDQUFDLENBQUMsQ0FBQyxFQUFFLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDO0FBQzNCLEtBQUssQ0FBQyxJQUFJLEdBQUcsVUFBUyxDQUFDLEVBQUU7QUFBRSxTQUFPLEtBQUssQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMs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QUMsQ0FBQyxHQUFHLFVBQVUsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQztBQUNqQyxHQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsVUFBVSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDO0FBQ2pDLE1BQUssT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDLEtBQUssUUFBUSxJQUN4QixPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxRQUFRLElBQ3hCLE9BQU8sQ0FBQyxLQUFLLFFBQVEsSUFDckIsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLEVBQUc7QUFDL0MsU0FBSyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7QUFDdEIsU0FBSyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7QUFDdEIsU0FBSyxDQUFDLEtBQUssR0FBRyxDQUFDLENBQUM7QUFDaEIsYUFBUyxDQUFDLE1BQU0sRUFBRSxDQUFDO0dBQ3BCLE1BQU07QUFDTCxTQUFLLENBQUMsK0JBQStCLENBQUMsQ0FBQztHQUN4QztBQUNELE9BQUssQ0FBQyxjQUFjLEVBQUUsQ0FBQztDQUN4QixDQUFDLENBQUMiLCJmaWxlIjoic3JjL2pzL2RpeXNjYXR0ZXJwbG90LmpzIiwic291cmNlc0NvbnRlbnQiOlsidmFyIGRpeWJ1Y2tldCA9IHt9OyAvLyBvdXIgZ2xvYmFsIHZhcmlhYmxlXG5kaXlidWNrZXQubGluZWFyUmVncmVzc2lvbiA9IHt9O1xudmFyIGRpeWxyID0gZGl5YnVja2V0LmxpbmVhclJlZ3Jlc3Npb247XG5kaXlsci5hbHBoYSA9IDAuMDAwMztcbmRpeWxyLnRoZXRhID0gWzAsMF07XG5kaXlsci5pdGVyYXRpb25zID0gMDtcblxuZGl5YnVja2V0LmRhdGEgPSBbXG4gIHsgeCA6IDUgICAsIHkgOiA0IH0sXG4gIHsgeCA6IDE1ICAsIHkgOiAyMH0sXG4gIHsgeCA6IDMwICAsIHkgOiA0NX0sXG4gIHsgeCA6IDEyICAsIHkgOiAxNX0sXG4gIHsgeCA6IDYwICAsIHkgOiA3MH0sXG4gIHsgeCA6IDU1ICAsIHkgOiA2OX0sXG4gIHsgeCA6IDI5ICAsIHkgOiAzMH0sXG4gIHsgeCA6IDQ0ICAsIHkgOiA0MH0sXG4gIHsgeCA6IDc4ICAsIHkgOiA4OX0sXG4gIHsgeCA6IDkwICAsIHkgOiA5NX0sXG4gIHsgeCA6IDY5ICAsIHkgOiA3N30sXG4gIHsgeCA6IDc0ICAsIHkgOiA3NH0sXG4gIHsgeCA6IDYwICAsIHkgOiA2Nn0sXG4gIHsgeCA6IDEwMCAsIHkgOiA5Nn1cbl07XG5cbi8vIFNDQVRURVIgUExPVCBTRVRVUFxuXG5kaXlidWNrZXQuc2NhdHRlcnBsb3QgPSB7fTsgLy8gZGl5YnVja2V0IGZvciB0aGUgc2NhdHRlciBwbG90XG52YXIgZGl5c3AgPSBkaXlidWNrZXQuc2NhdHRlcnBsb3Q7IC8vIGNvbnZlbmllbmNlIHZhcmlhYmxlXG5kaXlzcC5tYXJnaW4gPSB7IHRvcDogMjAsIHJpZ2h0OiAyMCwgYm90dG9tOiAzMCwgbGVmdDogNDAgfTtcbmRpeXNwLndpZHRoID0gNjAwIC0gZGl5c3AubWFyZ2luLmxlZnQgLSBkaXlzcC5tYXJnaW4ucmlnaHQ7XG5kaXlzcC5oZWlnaHQ9IDMxMyAtIGRpeXNwLm1hcmdpbi50b3AgLSBkaXlzcC5tYXJnaW4uYm90dG9tO1xuXG4vLyBzZXR1cCB4XG5kaXlzcC54VmFsdWUgPSBmdW5jdGlvbihkKSB7IHJldHVybiBkLng7IH07IC8vIGRhdGEgLT4gdmFsdWVcbmRpeXNwLnhTY2FsZSA9IGQzLnNjYWxlLmxpbmVhcigpXG4gIC5kb21haW4oWzAsMTAwXSlcbiAgLnJhbmdlKFswLCBkaXlzcC53aWR0aF0pOyAvLyB2YWx1ZSAtPiBkaWRpeXNwbGF5XG5kaXlzcC54TWFwID0gZnVuY3Rpb24oZCkgeyByZXR1cm4gZGl5c3AueFNjYWxlKGRpeXNwLnhWYWx1ZShkKSk7IH07IC8vIGRhdGEgLT4gZGlkaXlzcGxheVxuZGl5c3AueEF4aXMgPSBkMy5zdmcuYXhpcygpXG4gIC5zY2FsZShkaXlzcC54U2NhbGUpXG4gIC5vcmllbnQoXCJib3R0b21cIik7XG5cbi8vIHNldHVwIHlcbmRpeXNwLnlWYWx1ZSA9IGZ1bmN0aW9uKGQpIHsgcmV0dXJuIGQueTsgfTsgLy8gZGF0YSAtPiB2YWx1ZVxuZGl5c3AueVNjYWxlID0gZDMuc2NhbGUubGluZWFyKClcbiAgLmRvbWFpbihbMCwxMDBdKVxuICAucmFuZ2UoW2RpeXNwLmhlaWdodCwwXSk7IC8vIHZhbHVlIC0+IGRpZGl5c3BsYXlcbmRpeXNwLnlNYXAgPSBmdW5jdGlvbihkKSB7IHJldHVybiBkaXlzcC55U2NhbGUoZGl5c3AueVZhbHVlKGQpKTsgfTsgLy8gZGF0YSAtPiBkaWRpeXNwbGF5XG5kaXlzcC55QXhpcyA9IGQzLnN2Zy5heGlzKClcbiAgLnNjYWxlKGRpeXNwLnlTY2FsZSlcbiAgLm9yaWVudChcImxlZnRcIik7XG5cbi8vIHNldHVwIGNvbG9yIHNjYWxlXG5kaXlzcC5jb2xvclNjYWxlID0gZDMuc2NhbGUubGluZWFyKClcbiAgLnJhbmdlKFtcImhzbCgyMCw5MCUsNDAlKVwiLCBcImhzbCgxODAsNjAlLDQwJSlcIl0pO1xuXG4vLyBhZGQgZ3JhcGggY2FudmFzIHRvICNzY2F0dGVycGxvdCBkaXZcbmRpeXNwLnN2ZyA9IGQzLnNlbGVjdChcIiNkaXlzY2F0dGVycGxvdFwiKS5hcHBlbmQoXCJzdmdcIilcbiAgICAuYXR0cihcIndpZHRoXCIsIGRpeXNwLndpZHRoICsgZGl5c3AubWFyZ2luLmxlZnQgKyBkaXlzcC5tYXJnaW4ucmlnaHQpXG4gICAgLmF0dHIoXCJoZWlnaHRcIiwgZGl5c3AuaGVpZ2h0ICsgZGl5c3AubWFyZ2luLmJvdHRvbSArIGRpeXNwLm1hcmdpbi50b3ApXG4gIC5hcHBlbmQoXCJnXCIpXG4gICAgLmF0dHIoXCJ0cmFuc2Zvcm1cIiwgYHRyYW5zbGF0ZSgke2RpeXNwLm1hcmdpbi5sZWZ0fSwke2RpeXNwLm1hcmdpbi50b3B9KWApO1xuXG4vLyB4LWF4aXNcbmRpeXNwLnN2Zy5hcHBlbmQoXCJnXCIpXG4gICAgLmF0dHIoe1xuICAgICAgY2xhc3MgOiBcInggYXhpc1wiLFxuICAgICAgdHJhbnNmb3JtIDogYHRyYW5zbGF0ZSgwLCR7ZGl5c3AuaGVpZ2h0fSlgXG4gICAgfSlcbiAgICAuY2FsbChkaXlzcC54QXhpcylcbiAgLmFwcGVuZChcInRleHRcIilcbiAgICAuYXR0cih7XG4gICAgICBjbGFzcyA6IFwibGFiZWxcIixcbiAgICAgIHggICAgIDogZGl5c3Aud2lkdGgsXG4gICAgICB5ICAgICA6IC02XG4gICAgfSlcbiAgICAuc3R5bGUoXCJ0ZXh0LWFuY2hvclwiLCBcImVuZFwiKVxuICAgIC50ZXh0KFwieFwiKTtcblxuLy8geS1heGlzXG5kaXlzcC5zdmcuYXBwZW5kKFwiZ1wiKVxuICAgIC5hdHRyKFwiY2xhc3NcIiwgXCJ5IGF4aXNcIilcbiAgICAuY2FsbChkaXlzcC55QXhpcylcbiAgLmFwcGVuZChcInRleHRcIilcbiAgICAuYXR0cih7XG4gICAgICBjbGFzcyA6IFwibGFiZWxcIixcbiAgICAgIHRyYW5zZm9ybSA6IFwicm90YXRlKC05MClcIixcbiAgICAgIHkgICAgIDogNixcbiAgICAgIGR5ICAgIDogXCIuNzFlbVwiXG4gICAgfSlcbiAgICAuc3R5bGUoXCJ0ZXh0LWFuY2hvclwiLCBcImVuZFwiKVxuICAgIC50ZXh0KFwieVwiKTtcblxuLy8gQ0hBTkdFUyBUTyBTQ0FUVEVSIFBMT1RcbmRpeWJ1Y2tldC51cGRhdGUgPSBmdW5jdGlvbigpIHtcblxuICAvLyBidWZmZXIgYWRkZWQgdG8gZGF0YSBkb21haW4gdG8gcHJldmVudCBvdmVybGFwcGluZyBheGlzXG4vLyAgZGl5c3AueFNjYWxlLmRvbWFpbihbZDMubWluKGRhdGEsZGl5c3AueFZhbHVlKS0xLCBkMy5tYXgoZGF0YSxkaXlzcC54VmFsdWUpKzFdKTtcbi8vICBkaXlzcC55U2NhbGUuZG9tYWluKFtkMy5taW4oZGF0YSxkaXlzcC55VmFsdWUpLTEsIGQzLm1heChkYXRhLGRpeXNwLnlWYWx1ZSkrMV0pO1xuICBkaXlzcC54U2NhbGUuZG9tYWluKFswLDEwMF0pO1xuICBkaXlzcC55U2NhbGUuZG9tYWluKFswLDEwMF0pO1xuICBkaXlzcC5jb2xvclNjYWxlLmRvbWFpbihbZDMubWluKGRpeWJ1Y2tldC5kYXRhLGRpeXNwLnlWYWx1ZSktMSxkMy5tYXgoZGl5YnVja2V0LmRhdGEsZGl5c3AueVZhbHVlKSsxXSkubmljZSgpO1xuXG4gIC8vIHVwZGF0ZSBheGVzXG4gIGRpeXNwLnN2Zy5zZWxlY3QoXCIueC5heGlzXCIpXG4gICAgLnRyYW5zaXRpb24oKVxuICAgIC5kdXJhdGlvbigxMDAwKVxuICAgIC5jYWxsKGRpeXNwLnhBeGlzKTtcblxuICBkaXlzcC5zdmcuc2VsZWN0KFwiLnkuYXhpc1wiKVxuICAgIC50cmFuc2l0aW9uKClcbiAgICAuZHVyYXRpb24oMTAwMClcbiAgICAuY2FsbChkaXlzcC55QXhpcyk7XG5cbiAgLy8gZG90c1xuICB2YXIgZG90cyA9IGRpeXNwLnN2Zy5zZWxlY3RBbGwoXCIuZG90XCIpXG4gICAgLmRhdGEoZGl5YnVja2V0LmRhdGEpXG4gICAgLmF0dHIoe1xuICAgICAgY2xhc3MgOiBcImRvdFwiLFxuICAgICAgciAgICAgOiAzLjUsXG4gICAgICBjeCAgICA6IGRpeXNwLnhNYXAsXG4gICAgICBjeSAgICA6IGRpeXNwLnlNYXBcbiAgICB9KVxuICAgIC5zdHlsZShcImZpbGxcIiwgZnVuY3Rpb24oZCkgeyByZXR1cm4gZGl5c3AuY29sb3JTY2FsZShkaXlzcC55VmFsdWUoZCkpOyB9KVxuXG4gIGRvdHMuZW50ZXIoKVxuICAgIC5hcHBlbmQoXCJjaXJjbGVcIilcbiAgICAuYXR0cih7XG4gICAgICBjbGFzcyA6IFwiZG90XCIsXG4gICAgICByICAgICA6IDMuNSxcbiAgICAgIGN4ICAgIDogZGl5c3AueE1hcCxcbiAgICAgIGN5ICAgIDogZGl5c3AueU1hcFxuICAgIH0pXG4gICAgLnN0eWxlKFwiZmlsbFwiLCBmdW5jdGlvbihkKSB7IHJldHVybiBkaXlzcC5jb2xvclNjYWxlKGRpeXNwLnlWYWx1ZShkKSk7IH0pXG4gICAgLm9uKFwiY2xpY2tcIiwgZnVuY3Rpb24oZCxpKSB7XG4gICAgICBpZiAoZGl5YnVja2V0LmRhdGEubGVuZ3RoID4gMikge1xuICAgICAgICBkaXlidWNrZXQuZGF0YS5zcGxpY2UoaSwxKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGFsZXJ0KCdoZXkgbWFuLCBub3QgY29vbC4gXFxuXFxuZXZlcnlvbmUga25vd3MgdGhlcmUgaGF2ZSB0byBleGlzdCBhdCBsZWFzdCB0d28gcG9pbnRzIGZvciBhIGxpbmUgdG8gZXhpc3QuJylcbiAgICAgIH1cbiAgICAgIGRpeWJ1Y2tldC51cGRhdGUoKTtcbiAgICB9KTtcblxuICBkb3RzLmV4aXQoKS5yZW1vdmUoKTtcblxuICAvLyBjYWxjdWxhdGUgdGhldGEgdmFsdWVzIHVzaW5nIGdyYWRpZW50IGRlc2NlbnRcbiAgLy8gYmVnaW5zIHdpdGggYSBcImd1ZXNzXCIsIHdoaWNoIGlzIHRoZXRhXzAgPSAwLCB0aGV0YV8xID0gMFxuICAvLyBhLmsuYS4gLSB0aGUgeC1heGlzICh5ID0gMCAqIHggKyAwID0+IHkgPSAwKVxuXG4gIGRpeWxyLmFscGhhID0gZGl5bHIuYWxwaGEgfHwgMC4wMDAzLFxuICBkaXlsci50aGV0YSA9IGRpeWxyLnRoZXRhIHx8IFswLDBdLFxuICBkaXlsci5qSGlzdG9yeSA9IFtdLFxuICBkaXlsci50aGV0YUhpc3RvcnkgPSBbXTtcbiAgdmFyIGkgPSAwLFxuICAgICAgZGlmZmVyZW5jZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICBpZiAoaSA8IDE1MDAwMCkge1xuICAgICAgICAgIHJldHVybiBkaXlsci5qSGlzdG9yeVtpLTJdID9cbiAgICAgICAgICAgIGRpeWxyLmpIaXN0b3J5W2ktMl0gLSBkaXlsci5qSGlzdG9yeVtpLTFdIDpcbiAgICAgICAgICAgIDE7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIDA7XG4gICAgICB9O1xuXG4gIGRvIHtcbiAgICBkaXlsci50aGV0YSA9IGdyYWRpZW50RGVzY2VudChkaXlidWNrZXQuZGF0YSxkaXlsci5hbHBoYSxkaXlsci50aGV0YSk7XG4gICAgZGl5bHIuakhpc3RvcnkucHVzaChKKGRpeWJ1Y2tldC5kYXRhLGRpeWxyLnRoZXRhKSk7XG4gICAgZGl5bHIudGhldGFIaXN0b3J5LnB1c2goZGl5bHIudGhldGEpO1xuICAgIGkrKztcbiAgfSB3aGlsZSAoZGlmZmVyZW5jZSgpID4gMC4wMDAxKTtcblxuICBkaXlsci5pdGVyYXRpb25zID0gaTtcblxuICB2YXIgbWF4WCA9IGQzLm1heChkaXlidWNrZXQuZGF0YSxkaXlzcC54VmFsdWUpO1xuICAvLyB2YXIgbWluWCA9IGQzLm1pbihkaXlidWNrZXQuZGF0YSxkaXlzcC54VmFsdWUpO1xuICB2YXIgbWluWCA9IDA7XG4gIGRpeXNwLnN2Zy5zZWxlY3RBbGwoXCJsaW5lXCIpLnJlbW92ZSgpO1xuICB2YXIgbGluZU9mQmVzdEZpdCA9IGRpeXNwLnN2Zy5hcHBlbmQoXCJsaW5lXCIpXG4gICAgLmF0dHIoe1xuICAgICAgeDEgOiBkaXlzcC54U2NhbGUobWluWCksXG4gICAgICB5MSA6IGRpeXNwLnlTY2FsZShtaW5YKmRpeWxyLnRoZXRhWzFdICsgZGl5bHIudGhldGFbMF0pLFxuICAgICAgeDIgOiBkaXlzcC54U2NhbGUobWF4WCksXG4gICAgICB5MiA6IGRpeXNwLnlTY2FsZShtYXhYKmRpeWxyLnRoZXRhWzFdICsgZGl5bHIudGhldGFbMF0pLFxuICAgICAgXCJzdHJva2VcIiA6IFwiIzFDREVDNFwiLFxuICAgICAgXCJzdHJva2Utd2lkdGhcIiA6IDJcbiAgICB9KTtcblxuICAvLyBkaXNwbGF5IHRoZSBlcXVhdGlvbiBmb3IgdGhlIGxpbmUgb2YgYmVzdCBmaXRcbiAgdmFyIGRvY0ZyYWcgPSBkb2N1bWVudC5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCk7XG4gIHZhciBlcSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ1AnKTtcbiAgZG9jRnJhZy5hcHBlbmRDaGlsZChlcSk7XG4gIHZhciBlcVRleHQgPSBkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZShgeSA9ICR7ZGl5bHIudGhldGFbMV0udG9QcmVjaXNpb24oMyl9eCArICR7ZGl5bHIudGhldGFbMF0udG9QcmVjaXNpb24oMyl9YCk7XG4gIGVxLmFwcGVuZENoaWxkKGVxVGV4dCk7XG4gICQoXCIjZGl5ZXF1YXRpb25cIikuZW1wdHkoKTtcbiAgJChcIiNkaXllcXVhdGlvblwiKS5hcHBlbmQoZG9jRnJhZyk7XG5cbiAgdmFyIGRvY0ZyYWcyID0gZG9jdW1lbnQuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpO1xuICB2YXIgbnVtSXRlcnMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdQJyk7XG4gIGRvY0ZyYWcyLmFwcGVuZENoaWxkKG51bUl0ZXJzKTtcbiAgdmFyIG51bUl0ZXJzVGV4dCA9IGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKGBudW1iZXIgb2YgaXRlcmF0aW9uczogJHtkaXlsci5pdGVyYXRpb25zfWApO1xuICBudW1JdGVycy5hcHBlbmRDaGlsZChudW1JdGVyc1RleHQpO1xuICAkKFwiI251bS1pdGVyc1wiKS5lbXB0eSgpO1xuICAkKFwiI251bS1pdGVyc1wiKS5hcHBlbmQoZG9jRnJhZzIpO1xufTtcbmRpeWJ1Y2tldC51cGRhdGUoKTtcblxuLy8gYWRkcyBhIG5ldywgcmFuZG9tbHkgZ2VuZXJhdGVkIGRhdHVtIHRvIGdyYXBoXG5kMy5zZWxlY3QoXCIjZGl5YWRkXCIpXG4gIC5vbihcImNsaWNrXCIsIGZ1bmN0aW9uKCkge1xuICAgIHZhciBuZXdEb3QgPSB7fTtcbiAgICBuZXdEb3QueCA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDEwMCk7XG4gICAgbmV3RG90LnkgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMDApO1xuICAgIGRpeWJ1Y2tldC5kYXRhLnB1c2gobmV3RG90KTtcbiAgICBkaXlidWNrZXQudXBkYXRlKCk7XG4gIH0pO1xuXG4kKCcjZGl5cnVuJykub24oJ2NsaWNrJywgZnVuY3Rpb24oZXZlbnQpIHtcbiAgdmFyIHQgPSBbXSxcbiAgICAgIGEgPSBwYXJzZUZsb2F0KCQoJyNhbHBoYScpLnZhbCgpKTtcbiAgdFswXSA9IHBhcnNlRmxvYXQoJCgnI2InKS52YWwoKSk7XG4gIHRbMV0gPSBwYXJzZUZsb2F0KCQoJyNtJykudmFsKCkpO1xuICBpZiAoIHR5cGVvZiB0WzBdID09PSBcIm51bWJlclwiXG4gICAgJiYgdHlwZW9mIHRbMV0gPT09IFwibnVtYmVyXCJcbiAgICAmJiB0eXBlb2YgYSA9PT0gXCJudW1iZXJcIlxuICAgICYmICFpc05hTih0WzBdKSAmJiAhaXNOYU4odFsxXSkgJiYgIWlzTmFOKGEpICkge1xuICAgIGRpeWxyLnRoZXRhWzBdID0gdFswXTtcbiAgICBkaXlsci50aGV0YVsxXSA9IHRbMV07XG4gICAgZGl5bHIuYWxwaGEgPSBhO1xuICAgIGRpeWJ1Y2tldC51cGRhdGUoKTtcbiAgfSBlbHNlIHtcbiAgICBhbGVydChcInZhbHVlcyBtdXN0IGVhY2ggYmUgYSBudW1iZXIuXCIpO1xuICB9XG4gIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG59KTtcbiJdfQ==
