"use strict";

var samplebucket = {}; // our global variable
samplebucket.sampleLinearRegression = {};
var slr = samplebucket.sampleLinearRegression;

// SCATTER PLOT SETUP

samplebucket.sampleScatterplot = {}; // bucket for the scatter plot
var ssp = samplebucket.sampleScatterplot; // convenience variable
ssp.margin = { top: 20, right: 20, bottom: 30, left: 40 };
ssp.width = 480 - ssp.margin.left - ssp.margin.right;
ssp.height = 250 - ssp.margin.top - ssp.margin.bottom;

// setup x
ssp.xValue = function (d) {
  return d.x;
}; // data -> value
ssp.xScale = d3.scale.linear().domain([0, 100]).range([0, ssp.width]); // value -> dissplay
ssp.xMap = function (d) {
  return ssp.xScale(ssp.xValue(d));
}; // data -> dissplay
ssp.xAxis = d3.svg.axis().scale(ssp.xScale).orient("bottom");

// setup y
ssp.yValue = function (d) {
  return d.y;
}; // data -> value
ssp.yScale = d3.scale.linear().domain([0, 100]).range([ssp.height, 0]); // value -> dissplay
ssp.yMap = function (d) {
  return ssp.yScale(ssp.yValue(d));
}; // data -> dissplay
ssp.yAxis = d3.svg.axis().scale(ssp.yScale).orient("left");

// setup color scale
ssp.colorScale = d3.scale.linear().range(["hsl(20,90%,40%)", "hsl(180,60%,40%)"]);

// add graph canvas to #scatterplot div
ssp.svg = d3.select("#samplescatterplot").append("svg").attr("width", ssp.width + ssp.margin.left + ssp.margin.right).attr("height", ssp.height + ssp.margin.bottom + ssp.margin.top).append("g").attr("transform", "translate(" + ssp.margin.left + "," + ssp.margin.top + ")");

// x-axis
ssp.svg.append("g").attr({
  "class": "x axis",
  transform: "translate(0," + ssp.height + ")"
}).call(ssp.xAxis).append("text").attr({
  "class": "label",
  x: ssp.width,
  y: -6
}).style("text-anchor", "end").text("Population (10,000s)");

// y-axis
ssp.svg.append("g").attr("class", "y axis").call(ssp.yAxis).append("text").attr({
  "class": "label",
  transform: "rotate(-90)",
  y: 6,
  dy: ".71em"
}).style("text-anchor", "end").text("Profit ($10,000s)");

// load data
d3.select("#run").on("click", function () {

  d3.csv("../data.csv", function (err, data) {
    if (err) throw err;

    // change from CSV string into number format
    data.forEach(function (d) {
      d.x = +d.population;
      d.y = +d.profit;
    });
    samplebucket.data = data;

    // CHANGES TO SCATTER PLOT

    // buffer added to data domain to prevent overlapping axis
    ssp.xScale.domain([d3.min(data, ssp.xValue) - 1, d3.max(data, ssp.xValue) + 1]);
    ssp.yScale.domain([d3.min(data, ssp.yValue) - 1, d3.max(data, ssp.yValue) + 1]);
    ssp.colorScale.domain([d3.min(data, ssp.yValue) - 1, d3.max(data, ssp.yValue) + 1]).nice();

    // change axes labels
    ssp.svg.select(".x.axis").transition().duration(1000).call(ssp.xAxis);

    ssp.svg.select(".y.axis").transition().duration(1000).call(ssp.yAxis);

    var dots = ssp.svg.selectAll(".sampledot").data(data);
    dots.enter().append("circle").attr("class", "sampledot");
    dots.transition().delay(function (d, i) {
      return i * 50;
    }).attr({
      r: 3.5,
      cx: ssp.xMap,
      cy: ssp.yMap
    }).style("fill", function (d) {
      return ssp.colorScale(ssp.yValue(d));
    }).each("end", function (d, i) {
      if (i === data.length - 1) {
        drawLine();
      }
    });
    function drawLine() {
      var max = d3.max(samplebucket.data, ssp.xValue);
      var min = d3.min(samplebucket.data, ssp.xValue);
      var lineOfBestFit = ssp.svg.append("line").attr({
        x1: ssp.xScale(min),
        y1: ssp.yScale(min * slr.theta[1] + slr.theta[0]),
        x2: ssp.xScale(max),
        y2: ssp.yScale(max * slr.theta[1] + slr.theta[0]),
        "stroke": "#1CDEC4",
        "stroke-width": 2
      });
    }

    slr.alpha = 0.004, slr.theta = [0, 0], slr.jHistory = [], slr.thetaHistory = [];
    var i = 0,
        difference = function difference() {
      return slr.jHistory[i - 2] ? slr.jHistory[i - 2] - slr.jHistory[i - 1] : 1;
    };

    do {
      slr.theta = gradientDescent(data, slr.alpha, slr.theta);
      slr.jHistory.push(J(data, slr.theta));
      slr.thetaHistory.push(slr.theta);
      i++;
    } while (difference() > .0001);

    // debugger;
  });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNyYy9qcy9zYW1wbGVzY2F0dGVycGxvdC5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLElBQUksWUFBWSxHQUFHLEVBQUUsQ0FBQztBQUN0QixZQUFZLENBQUMsc0JBQXNCLEdBQUcsRUFBRSxDQUFDO0FBQ3pDLElBQUksR0FBRyxHQUFHLFlBQVksQ0FBQyxzQkFBc0IsQ0FBQzs7OztBQUk5QyxZQUFZLENBQUMsaUJBQWlCLEdBQUcsRUFBRSxDQUFDO0FBQ3BDLElBQUksR0FBRyxHQUFHLFlBQVksQ0FBQyxpQkFBaUIsQ0FBQztBQUN6QyxHQUFHLENBQUMsTUFBTSxHQUFHLEVBQUUsR0FBRyxFQUFFLEVBQUUsRUFBRSxLQUFLLEVBQUUsRUFBRSxFQUFFLE1BQU0sRUFBRSxFQUFFLEVBQUUsSUFBSSxFQUFFLEVBQUUsRUFBRSxDQUFDO0FBQzFELEdBQUcsQ0FBQyxLQUFLLEdBQUcsR0FBRyxHQUFHLEdBQUcsQ0FBQyxNQUFNLENBQUMsSUFBSSxHQUFHLEdBQUcsQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDO0FBQ3JELEdBQUcsQ0FBQyxNQUFNLEdBQUUsR0FBRyxHQUFHLEdBQUcsQ0FBQyxNQUFNLENBQUMsR0FBRyxHQUFHLEdBQUcsQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDOzs7QUFHckQsR0FBRyxDQUFDLE1BQU0sR0FBRyxVQUFTLENBQUMsRUFBRTtBQUFFLFNBQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQztDQUFFLENBQUM7QUFDekMsR0FBRyxDQUFDLE1BQU0sR0FBRyxFQUFFLENBQUMsS0FBSyxDQUFDLE1BQU0sRUFBRSxDQUMzQixNQUFNLENBQUMsQ0FBQyxDQUFDLEVBQUMsR0FBRyxDQUFDLENBQUMsQ0FDZixLQUFLLENBQUMsQ0FBQyxDQUFDLEVBQUUsR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7QUFDekIsR0FBRyxDQUFDLElBQUksR0FBRyxVQUFTLENBQUMsRUFBRTtBQUFFLFNBQU8sR0FBRyxDQUFDLE1BQU0sQ0FBQyxH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LENBQUM7QUFDdEIsUUFBSSxDQUFDLEdBQUcsQ0FBQztRQUNMLFVBQVUsR0FBRyxTQUFiLFVBQVUsR0FBYztBQUN0QixhQUFPLEdBQUcsQ0FBQyxRQUFRLENBQUMsQ0FBQyxHQUFDLENBQUMsQ0FBQyxHQUN0QixHQUFHLENBQUMsUUFBUSxDQUFDLENBQUMsR0FBQyxDQUFDLENBQUMsR0FBRyxHQUFHLENBQUMsUUFBUSxDQUFDLENBQUMsR0FBQyxDQUFDLENBQUMsR0FDckMsQ0FBQyxDQUFDO0tBQ0wsQ0FBQzs7QUFFTixPQUFHO0FBQ0QsU0FBRyxDQUFDLEtBQUssR0FBRyxlQUFlLENBQUMsSUFBSSxFQUFDLEdBQUcsQ0FBQyxLQUFLLEVBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFDO0FBQ3RELFNBQUcsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxJQUFJLEVBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7QUFDckMsU0FBRyxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFDO0FBQ2pDLE9BQUMsRUFBRSxDQUFDO0tBQ0wsUUFBUSxVQUFVLEVBQUUsR0FBRyxLQUFLLEVBQUU7OztHQUdoQyxDQUFDLENBQUM7Q0FDTixDQUFDLENBQUEiLCJmaWxlIjoic3JjL2pzL3NhbXBsZXNjYXR0ZXJwbG90LmpzIiwic291cmNlc0NvbnRlbnQiOlsidmFyIHNhbXBsZWJ1Y2tldCA9IHt9OyAvLyBvdXIgZ2xvYmFsIHZhcmlhYmxlXG5zYW1wbGVidWNrZXQuc2FtcGxlTGluZWFyUmVncmVzc2lvbiA9IHt9O1xudmFyIHNsciA9IHNhbXBsZWJ1Y2tldC5zYW1wbGVMaW5lYXJSZWdyZXNzaW9uO1xuXG4vLyBTQ0FUVEVSIFBMT1QgU0VUVVBcblxuc2FtcGxlYnVja2V0LnNhbXBsZVNjYXR0ZXJwbG90ID0ge307IC8vIGJ1Y2tldCBmb3IgdGhlIHNjYXR0ZXIgcGxvdFxudmFyIHNzcCA9IHNhbXBsZWJ1Y2tldC5zYW1wbGVTY2F0dGVycGxvdDsgLy8gY29udmVuaWVuY2UgdmFyaWFibGVcbnNzcC5tYXJnaW4gPSB7IHRvcDogMjAsIHJpZ2h0OiAyMCwgYm90dG9tOiAzMCwgbGVmdDogNDAgfTtcbnNzcC53aWR0aCA9IDQ4MCAtIHNzcC5tYXJnaW4ubGVmdCAtIHNzcC5tYXJnaW4ucmlnaHQ7XG5zc3AuaGVpZ2h0PSAyNTAgLSBzc3AubWFyZ2luLnRvcCAtIHNzcC5tYXJnaW4uYm90dG9tO1xuXG4vLyBzZXR1cCB4XG5zc3AueFZhbHVlID0gZnVuY3Rpb24oZCkgeyByZXR1cm4gZC54OyB9OyAvLyBkYXRhIC0+IHZhbHVlXG5zc3AueFNjYWxlID0gZDMuc2NhbGUubGluZWFyKClcbiAgLmRvbWFpbihbMCwxMDBdKVxuICAucmFuZ2UoWzAsIHNzcC53aWR0aF0pOyAvLyB2YWx1ZSAtPiBkaXNzcGxheVxuc3NwLnhNYXAgPSBmdW5jdGlvbihkKSB7IHJldHVybiBzc3AueFNjYWxlKHNzcC54VmFsdWUoZCkpOyB9OyAvLyBkYXRhIC0+IGRpc3NwbGF5XG5zc3AueEF4aXMgPSBkMy5zdmcuYXhpcygpXG4gIC5zY2FsZShzc3AueFNjYWxlKVxuICAub3JpZW50KFwiYm90dG9tXCIpO1xuXG4vLyBzZXR1cCB5XG5zc3AueVZhbHVlID0gZnVuY3Rpb24oZCkgeyByZXR1cm4gZC55OyB9OyAvLyBkYXRhIC0+IHZhbHVlXG5zc3AueVNjYWxlID0gZDMuc2NhbGUubGluZWFyKClcbiAgLmRvbWFpbihbMCwxMDBdKVxuICAucmFuZ2UoW3NzcC5oZWlnaHQsMF0pOyAvLyB2YWx1ZSAtPiBkaXNzcGxheVxuc3NwLnlNYXAgPSBmdW5jdGlvbihkKSB7IHJldHVybiBzc3AueVNjYWxlKHNzcC55VmFsdWUoZCkpOyB9OyAvLyBkYXRhIC0+IGRpc3NwbGF5XG5zc3AueUF4aXMgPSBkMy5zdmcuYXhpcygpXG4gIC5zY2FsZShzc3AueVNjYWxlKVxuICAub3JpZW50KFwibGVmdFwiKTtcblxuLy8gc2V0dXAgY29sb3Igc2NhbGVcbnNzcC5jb2xvclNjYWxlID0gZDMuc2NhbGUubGluZWFyKClcbiAgLnJhbmdlKFtcImhzbCgyMCw5MCUsNDAlKVwiLCBcImhzbCgxODAsNjAlLDQwJSlcIl0pO1xuXG4vLyBhZGQgZ3JhcGggY2FudmFzIHRvICNzY2F0dGVycGxvdCBkaXZcbnNzcC5zdmcgPSBkMy5zZWxlY3QoXCIjc2FtcGxlc2NhdHRlcnBsb3RcIikuYXBwZW5kKFwic3ZnXCIpXG4gICAgLmF0dHIoXCJ3aWR0aFwiLCBzc3Aud2lkdGggKyBzc3AubWFyZ2luLmxlZnQgKyBzc3AubWFyZ2luLnJpZ2h0KVxuICAgIC5hdHRyKFwiaGVpZ2h0XCIsIHNzcC5oZWlnaHQgKyBzc3AubWFyZ2luLmJvdHRvbSArIHNzcC5tYXJnaW4udG9wKVxuICAuYXBwZW5kKFwiZ1wiKVxuICAgIC5hdHRyKFwidHJhbnNmb3JtXCIsIGB0cmFuc2xhdGUoJHtzc3AubWFyZ2luLmxlZnR9LCR7c3NwLm1hcmdpbi50b3B9KWApO1xuXG4vLyB4LWF4aXNcbnNzcC5zdmcuYXBwZW5kKFwiZ1wiKVxuICAgIC5hdHRyKHtcbiAgICAgIGNsYXNzIDogXCJ4IGF4aXNcIixcbiAgICAgIHRyYW5zZm9ybSA6IGB0cmFuc2xhdGUoMCwke3NzcC5oZWlnaHR9KWBcbiAgICB9KVxuICAgIC5jYWxsKHNzcC54QXhpcylcbiAgLmFwcGVuZChcInRleHRcIilcbiAgICAuYXR0cih7XG4gICAgICBjbGFzcyA6IFwibGFiZWxcIixcbiAgICAgIHggICAgIDogc3NwLndpZHRoLFxuICAgICAgeSAgICAgOiAtNlxuICAgIH0pXG4gICAgLnN0eWxlKFwidGV4dC1hbmNob3JcIiwgXCJlbmRcIilcbiAgICAudGV4dChcIlBvcHVsYXRpb24gKDEwLDAwMHMpXCIpO1xuXG4vLyB5LWF4aXNcbnNzcC5zdmcuYXBwZW5kKFwiZ1wiKVxuICAgIC5hdHRyKFwiY2xhc3NcIiwgXCJ5IGF4aXNcIilcbiAgICAuY2FsbChzc3AueUF4aXMpXG4gIC5hcHBlbmQoXCJ0ZXh0XCIpXG4gICAgLmF0dHIoe1xuICAgICAgY2xhc3MgOiBcImxhYmVsXCIsXG4gICAgICB0cmFuc2Zvcm0gOiBcInJvdGF0ZSgtOTApXCIsXG4gICAgICB5ICAgICA6IDYsXG4gICAgICBkeSAgICA6IFwiLjcxZW1cIlxuICAgIH0pXG4gICAgLnN0eWxlKFwidGV4dC1hbmNob3JcIiwgXCJlbmRcIilcbiAgICAudGV4dChcIlByb2ZpdCAoJDEwLDAwMHMpXCIpO1xuXG4vLyBsb2FkIGRhdGFcbmQzLnNlbGVjdChcIiNydW5cIilcbiAgLm9uKFwiY2xpY2tcIiwgZnVuY3Rpb24oKSB7XG5cbiAgICBkMy5jc3YoJy4uL2RhdGEuY3N2JyxcbiAgICAgIGZ1bmN0aW9uKGVyciwgZGF0YSkge1xuICAgICAgICBpZihlcnIpIHRocm93IGVycjtcblxuICAgICAgICAvLyBjaGFuZ2UgZnJvbSBDU1Ygc3RyaW5nIGludG8gbnVtYmVyIGZvcm1hdFxuICAgICAgICBkYXRhLmZvckVhY2goZnVuY3Rpb24oZCkge1xuICAgICAgICAgIGQueCA9ICtkLnBvcHVsYXRpb247XG4gICAgICAgICAgZC55ICAgICA9ICtkLnByb2ZpdDtcbiAgICAgICAgfSk7XG4gICAgICAgIHNhbXBsZWJ1Y2tldC5kYXRhID0gZGF0YTtcblxuICAgICAgICAvLyBDSEFOR0VTIFRPIFNDQVRURVIgUExPVFxuXG4gICAgICAgIC8vIGJ1ZmZlciBhZGRlZCB0byBkYXRhIGRvbWFpbiB0byBwcmV2ZW50IG92ZXJsYXBwaW5nIGF4aXNcbiAgICAgICAgc3NwLnhTY2FsZS5kb21haW4oW2QzLm1pbihkYXRhLHNzcC54VmFsdWUpLTEsIGQzLm1heChkYXRhLHNzcC54VmFsdWUpKzFdKTtcbiAgICAgICAgc3NwLnlTY2FsZS5kb21haW4oW2QzLm1pbihkYXRhLHNzcC55VmFsdWUpLTEsIGQzLm1heChkYXRhLHNzcC55VmFsdWUpKzFdKTtcbiAgICAgICAgc3NwLmNvbG9yU2NhbGUuZG9tYWluKFtkMy5taW4oZGF0YSxzc3AueVZhbHVlKS0xLGQzLm1heChkYXRhLHNzcC55VmFsdWUpKzFdKS5uaWNlKCk7XG5cbiAgICAgICAgLy8gY2hhbmdlIGF4ZXMgbGFiZWxzXG4gICAgICAgIHNzcC5zdmcuc2VsZWN0KFwiLnguYXhpc1wiKVxuICAgICAgICAgIC50cmFuc2l0aW9uKClcbiAgICAgICAgICAuZHVyYXRpb24oMTAwMClcbiAgICAgICAgICAuY2FsbChzc3AueEF4aXMpO1xuXG4gICAgICAgIHNzcC5zdmcuc2VsZWN0KFwiLnkuYXhpc1wiKVxuICAgICAgICAgIC50cmFuc2l0aW9uKClcbiAgICAgICAgICAuZHVyYXRpb24oMTAwMClcbiAgICAgICAgICAuY2FsbChzc3AueUF4aXMpO1xuXG4gICAgICAgIHZhciBkb3RzID0gc3NwLnN2Zy5zZWxlY3RBbGwoXCIuc2FtcGxlZG90XCIpXG4gICAgICAgICAgICAuZGF0YShkYXRhKTtcbiAgICAgICAgZG90c1xuICAgICAgICAgIC5lbnRlcigpXG4gICAgICAgICAgLmFwcGVuZChcImNpcmNsZVwiKVxuICAgICAgICAgICAgLmF0dHIoXCJjbGFzc1wiLCBcInNhbXBsZWRvdFwiKTtcbiAgICAgICAgZG90c1xuICAgICAgICAgIC50cmFuc2l0aW9uKClcbiAgICAgICAgICAgIC5kZWxheShmdW5jdGlvbihkLGkpIHsgcmV0dXJuIGkgKiA1MDt9KVxuICAgICAgICAgICAgLmF0dHIoe1xuICAgICAgICAgICAgICByICAgICA6IDMuNSxcbiAgICAgICAgICAgICAgY3ggICAgOiBzc3AueE1hcCxcbiAgICAgICAgICAgICAgY3kgICAgOiBzc3AueU1hcFxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5zdHlsZShcImZpbGxcIiwgZnVuY3Rpb24oZCkgeyByZXR1cm4gc3NwLmNvbG9yU2NhbGUoc3NwLnlWYWx1ZShkKSk7IH0pXG4gICAgICAgICAgICAuZWFjaChcImVuZFwiLCBmdW5jdGlvbihkLGkpIHtcbiAgICAgICAgICAgICAgaWYgKGkgPT09IGRhdGEubGVuZ3RoIC0gMSkge1xuICAgICAgICAgICAgICAgIGRyYXdMaW5lKCk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICBmdW5jdGlvbiBkcmF3TGluZSgpIHtcbiAgICAgICAgICB2YXIgbWF4ID0gZDMubWF4KHNhbXBsZWJ1Y2tldC5kYXRhLHNzcC54VmFsdWUpO1xuICAgICAgICAgIHZhciBtaW4gPSBkMy5taW4oc2FtcGxlYnVja2V0LmRhdGEsc3NwLnhWYWx1ZSk7XG4gICAgICAgICAgdmFyIGxpbmVPZkJlc3RGaXQgPSBzc3Auc3ZnLmFwcGVuZChcImxpbmVcIilcbiAgICAgICAgICAgIC5hdHRyKHtcbiAgICAgICAgICAgICAgeDEgOiBzc3AueFNjYWxlKG1pbiksXG4gICAgICAgICAgICAgIHkxIDogc3NwLnlTY2FsZShtaW4qc2xyLnRoZXRhWzFdICsgc2xyLnRoZXRhWzBdKSxcbiAgICAgICAgICAgICAgeDIgOiBzc3AueFNjYWxlKG1heCksXG4gICAgICAgICAgICAgIHkyIDogc3NwLnlTY2FsZShtYXgqc2xyLnRoZXRhWzFdICsgc2xyLnRoZXRhWzBdKSxcbiAgICAgICAgICAgICAgXCJzdHJva2VcIiA6IFwiIzFDREVDNFwiLFxuICAgICAgICAgICAgICBcInN0cm9rZS13aWR0aFwiIDogMlxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICBzbHIuYWxwaGEgPSAwLjAwNCxcbiAgICAgICAgc2xyLnRoZXRhID0gWzAsMF0sXG4gICAgICAgIHNsci5qSGlzdG9yeSA9IFtdLFxuICAgICAgICBzbHIudGhldGFIaXN0b3J5ID0gW107XG4gICAgICAgIHZhciBpID0gMCxcbiAgICAgICAgICAgIGRpZmZlcmVuY2UgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIHNsci5qSGlzdG9yeVtpLTJdID9cbiAgICAgICAgICAgICAgICBzbHIuakhpc3RvcnlbaS0yXSAtIHNsci5qSGlzdG9yeVtpLTFdIDpcbiAgICAgICAgICAgICAgICAxO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICBkbyB7XG4gICAgICAgICAgc2xyLnRoZXRhID0gZ3JhZGllbnREZXNjZW50KGRhdGEsc2xyLmFscGhhLHNsci50aGV0YSk7XG4gICAgICAgICAgc2xyLmpIaXN0b3J5LnB1c2goSihkYXRhLHNsci50aGV0YSkpO1xuICAgICAgICAgIHNsci50aGV0YUhpc3RvcnkucHVzaChzbHIudGhldGEpO1xuICAgICAgICAgIGkrKztcbiAgICAgICAgfSB3aGlsZSAoZGlmZmVyZW5jZSgpID4gLjAwMDEpO1xuXG4gICAgICAgIC8vIGRlYnVnZ2VyO1xuICAgICAgfSk7XG4gIH0pXG4iXX0=
