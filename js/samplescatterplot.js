"use strict";

var samplebucket = {}; // our global variable
samplebucket.sampleLinearRegression = {};
var slr = samplebucket.sampleLinearRegression;

// SCATTER PLOT SETUP

samplebucket.sampleScatterplot = {}; // bucket for the scatter plot
var ssp = samplebucket.sampleScatterplot; // convenience variable
ssp.margin = { top: 20, right: 20, bottom: 30, left: 40 };
ssp.width = 480 - ssp.margin.left - ssp.margin.right;
ssp.height = 250 - ssp.margin.top - ssp.margin.bottom;

// setup x
ssp.xValue = function (d) {
  return d.x;
}; // data -> value
ssp.xScale = d3.scale.linear().domain([0, 100]).range([0, ssp.width]); // value -> dissplay
ssp.xMap = function (d) {
  return ssp.xScale(ssp.xValue(d));
}; // data -> dissplay
ssp.xAxis = d3.svg.axis().scale(ssp.xScale).orient("bottom");

// setup y
ssp.yValue = function (d) {
  return d.y;
}; // data -> value
ssp.yScale = d3.scale.linear().domain([0, 100]).range([ssp.height, 0]); // value -> dissplay
ssp.yMap = function (d) {
  return ssp.yScale(ssp.yValue(d));
}; // data -> dissplay
ssp.yAxis = d3.svg.axis().scale(ssp.yScale).orient("left");

// setup color scale
ssp.colorScale = d3.scale.linear().range(["hsl(20,90%,40%)", "hsl(180,60%,40%)"]);

// add graph canvas to #scatterplot div
ssp.svg = d3.select("#samplescatterplot").append("svg").attr("width", ssp.width + ssp.margin.left + ssp.margin.right).attr("height", ssp.height + ssp.margin.bottom + ssp.margin.top).append("g").attr("transform", "translate(" + ssp.margin.left + "," + ssp.margin.top + ")");

// x-axis
ssp.svg.append("g").attr({
  "class": "x axis",
  transform: "translate(0," + ssp.height + ")"
}).call(ssp.xAxis).append("text").attr({
  "class": "label",
  x: ssp.width,
  y: -6
}).style("text-anchor", "end").text("Population (10,000s)");

// y-axis
ssp.svg.append("g").attr("class", "y axis").call(ssp.yAxis).append("text").attr({
  "class": "label",
  transform: "rotate(-90)",
  y: 6,
  dy: ".71em"
}).style("text-anchor", "end").text("Profit ($10,000s)");

// load data
d3.select("#run").on("click", function () {

  d3.csv("./data.csv", function (err, data) {
    if (err) throw err;

    // change from CSV string into number format
    data.forEach(function (d) {
      d.x = +d.population;
      d.y = +d.profit;
    });
    samplebucket.data = data;

    // CHANGES TO SCATTER PLOT

    // buffer added to data domain to prevent overlapping axis
    ssp.xScale.domain([d3.min(data, ssp.xValue) - 1, d3.max(data, ssp.xValue) + 1]);
    ssp.yScale.domain([d3.min(data, ssp.yValue) - 1, d3.max(data, ssp.yValue) + 1]);
    ssp.colorScale.domain([d3.min(data, ssp.yValue) - 1, d3.max(data, ssp.yValue) + 1]).nice();

    // change axes labels
    ssp.svg.select(".x.axis").transition().duration(1000).call(ssp.xAxis);

    ssp.svg.select(".y.axis").transition().duration(1000).call(ssp.yAxis);

    var dots = ssp.svg.selectAll(".sampledot").data(data);
    dots.enter().append("circle").attr("class", "sampledot");
    dots.transition().delay(function (d, i) {
      return i * 50;
    }).attr({
      r: 3.5,
      cx: ssp.xMap,
      cy: ssp.yMap
    }).style("fill", function (d) {
      return ssp.colorScale(ssp.yValue(d));
    }).each("end", function (d, i) {
      if (i === data.length - 1) {
        drawLine();
      }
    });
    function drawLine() {
      var max = d3.max(samplebucket.data, ssp.xValue);
      var min = d3.min(samplebucket.data, ssp.xValue);
      var lineOfBestFit = ssp.svg.append("line").attr({
        x1: ssp.xScale(min),
        y1: ssp.yScale(min * slr.theta[1] + slr.theta[0]),
        x2: ssp.xScale(max),
        y2: ssp.yScale(max * slr.theta[1] + slr.theta[0]),
        "stroke": "#1CDEC4",
        "stroke-width": 2
      });
    }

    slr.alpha = 0.004, slr.theta = [0, 0], slr.jHistory = [], slr.thetaHistory = [];
    var i = 0,
        difference = function difference() {
      return slr.jHistory[i - 2] ? slr.jHistory[i - 2] - slr.jHistory[i - 1] : 1;
    };

    do {
      slr.theta = gradientDescent(data, slr.alpha, slr.theta);
      slr.jHistory.push(J(data, slr.theta));
      slr.thetaHistory.push(slr.theta);
      i++;
    } while (difference() > .0001);

    // debugger;
  });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNyYy9qcy9zYW1wbGVzY2F0dGVycGxvdC5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLElBQUksWUFBWSxHQUFHLEVBQUUsQ0FBQztBQUN0QixZQUFZLENBQUMsc0JBQXNCLEdBQUcsRUFBRSxDQUFDO0FBQ3pDLElBQUksR0FBRyxHQUFHLFlBQVksQ0FBQyxzQkFBc0IsQ0FBQzs7OztBQUk5QyxZQUFZLENBQUMsaUJBQWlCLEdBQUcsRUFBRSxDQUFDO0FBQ3BDLElBQUksR0FBRyxHQUFHLFlBQVksQ0FBQyxpQkFBaUIsQ0FBQztBQUN6QyxHQUFHLENBQUMsTUFBTSxHQUFHLEVBQUUsR0FBRyxFQUFFLEVBQUUsRUFBRSxLQUFLLEVBQUUsRUFBRSxFQUFFLE1BQU0sRUFBRSxFQUFFLEVBQUUsSUFBSSxFQUFFLEVBQUUsRUFBRSxDQUFDO0FBQzFELEdBQUcsQ0FBQyxLQUFLLEdBQUcsR0FBRyxHQUFHLEdBQUcsQ0FBQyxNQUFNLENBQUMsSUFBSSxHQUFHLEdBQUcsQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDO0FBQ3JELEdBQUcsQ0FBQyxNQUFNLEdBQUUsR0FBRyxHQUFHLEdBQUcsQ0FBQyxNQUFNLENBQUMsR0FBRyxHQUFHLEdBQUcsQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDOzs7QUFHckQsR0FBRyxDQUFDLE1BQU0sR0FBRyxVQUFTLENBQUMsRUFBRTtBQUFFLFNBQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQztDQUFFLENBQUM7QUFDekMsR0FBRyxDQUFDLE1BQU0sR0FBRyxFQUFFLENBQUMsS0FBSyxDQUFDLE1BQU0sRUFBRSxDQUMzQixNQUFNLENBQUMsQ0FBQyxDQUFDLEVBQUMsR0FBRyxDQUFDLENBQUMsQ0FDZixLQUFLLENBQUMsQ0FBQyxDQUFDLEVBQUUsR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7QUFDekIsR0FBRyxDQUFDLElBQUksR0FBRyxVQUFTLENBQUMsRUFBRTtBQUFFLFNBQU8sR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7Q0FBRSxDQUFDO0FBQzdELEdBQUcsQ0FBQyxLQUFLLEdBQUcsRUFBRSxDQUFDLEdBQUcsQ0FBQyxJQUFJLEVBQUUsQ0FDdEIsS0FBSyxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsQ0FDakIsTUFBTSxDQUFDLFFBQVEsQ0FBQyxDQUFDOzs7QUFHcEIsR0FBRyxDQUFDLE1BQU0sR0FBRyxVQUFTLENBQUMsRUFBRTtBQUFFLFNBQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQztDQUFFLENBQUM7QUFDekMsR0FBRyxDQUFDLE1BQU0sR0FBRyxFQUFFLENBQUMsS0FBSyxDQUFDLE1BQU0sRUFBRSxDQUMzQixNQUFNLENBQUMsQ0FBQyxDQUFDLEVBQUMsR0FBRyxDQUFDLENBQUMsQ0FDZixLQUFLLENBQUMsQ0FBQyxHQUFHLENBQUMsTUFBTSxFQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7QUFDekIsR0FBRyxDQUFDLElBQUksR0FBRyxVQUFTLENBQUMsRUFBRTtBQUFFLFNBQU8sR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7Q0FBRSxDQUFDO0FBQzdELEdBQUcsQ0FBQyxLQUFLLEdBQUcsRUFBRSxDQUFDLEdBQUcsQ0FBQyxJQUFJLEVBQUUsQ0FDdEIsS0FBSyxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsQ0FDakIsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDOzs7QUFHbEIsR0FBRyxDQUFDLFVBQVUsR0FBRyxFQUFFLENBQUMsS0FBSyxDQUFDLE1BQU0sRUFBRSxDQUMvQixLQUFLLENBQUMsQ0FBQyxpQkFBaUIsRUFBRSxrQkFBa0IsQ0FBQyxDQUFDLENBQUM7OztBQUdsRCxHQUFHLENBQUMsR0FBRyxHQUFHLEVBQUUsQ0FBQyxNQUFNLENBQUMsb0JBQW9CLENBQUMsQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQ2xELElBQUksQ0FBQyxPQUFPLEVBQUUsR0FBRyxDQUFDLEtBQUssR0FBRyxHQUFHLENBQUMsTUFBTSxDQUFDLElBQUksR0FBRyxHQUFHLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUM3RCxJQUFJLENBQUMsUUFBUSxFQUFFLEdBQUcsQ0FBQyxNQUFNLEdBQUcsR0FBRyxDQUFDLE1BQU0sQ0FBQyxNQUFNLEdBQUcsR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FDakUsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUNULElBQUksQ0FBQyxXQUFXLGlCQUFlLEdBQUcsQ0FBQyxNQUFNLENBQUMsSUFBSSxTQUFJLEdBQUcsQ0FBQyxNQUFNLENBQUMsR0FBRyxPQUFJLENBQUM7OztBQUcxRSxHQUFHLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FDZCxJQUFJLENBQUM7QUFDSixXQUFRLFFBQVE7QUFDaEIsV0FBUyxtQkFBa0IsR0FBRyxDQUFDLE1BQU0sTUFBRztDQUN6QyxDQUFDLENBQ0QsSUFBSSxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsQ0FDakIsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUNaLElBQUksQ0FBQztBQUNKLFdBQVEsT0FBTztBQUNmLEdBQUMsRUFBTyxHQUFHLENBQUMsS0FBSztBQUNqQixHQUFDLEVBQU8sQ0FBQyxDQUFDO0NBQ1gsQ0FBQyxDQUNELEtBQUssQ0FBQyxhQUFhLEVBQUUsS0FBSyxDQUFDLENBQzNCLElBQUksQ0FBQyxzQkFBc0IsQ0FBQyxDQUFDOzs7QUFHbEMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQ2QsSUFBSSxDQUFDLE9BQU8sRUFBRSxRQUFRLENBQUMsQ0FDdkIsSUFBSSxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsQ0FDakIsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUNaLElBQUksQ0FBQztBQUNKLFdBQVEsT0FBTztBQUNmLFdBQVMsRUFBRyxhQUFhO0FBQ3pCLEdBQUMsRUFBTyxDQUFDO0FBQ1QsSUFBRSxFQUFNLE9BQU87Q0FDaEIsQ0FBQyxDQUNELEtBQUssQ0FBQyxhQUFhLEVBQUUsS0FBSyxDQUFDLENBQzNCLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxDQUFDOzs7QUFHL0IsRUFBRSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FDZCxFQUFFLENBQUMsT0FBTyxFQUFFLFlBQVc7O0FBRXRCLElBQUUsQ0FBQyxHQUFHLENBQUMsWUFBWSxFQUNqQixVQUFTLEdBQUcsRUFBRSxJQUFJLEVBQUU7QUFDbEIsUUFBRyxHQUFHLEVBQUUsTUFBTSxHQUFHLENBQUM7OztBQUdsQixRQUFJLENBQUMsT0FBTyxDQUFDLFVBQVMsQ0FBQyxFQUFFO0FBQ3ZCLE9BQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsVUFBVSxDQUFDO0FBQ3BCLE9BQUMsQ0FBQyxDQUFDLEdBQU8sQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDO0tBQ3JCLENBQUMsQ0FBQztBQUNILGdCQUFZLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQzs7Ozs7QUFLekIsT0FBRyxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLElBQUksRUFBQyxHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxHQUFHLENBQUMsSUFBSSxFQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsR0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0FBQzFFLE9BQUcsQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxJQUFJLEVBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFDLENBQUMsRUFBRSxFQUFFLENBQUMsR0FBRyxDQUFDLElBQUksRUFBQyxHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztBQUMxRSxPQUFHLENBQUMsVUFBVSxDQUFDLE1BQU0sQ0FBQyxDQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUMsSUFBSSxFQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsR0FBQyxDQUFDLEVBQUMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxJQUFJLEVBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxFQUFFLENBQUM7OztBQUdwRixPQUFHLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxTQUFTLENBQUMsQ0FDdEIsVUFBVSxFQUFFLENBQ1osUUFBUSxDQUFDLElBQUksQ0FBQyxDQUNkLElBQUksQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLENBQUM7O0FBRW5CLE9BQUcsQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLFNBQVMsQ0FBQyxDQUN0QixVQUFVLEVBQUUsQ0FDWixRQUFRLENBQUMsSUFBSSxDQUFDLENBQ2QsSUFBSSxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsQ0FBQzs7QUFFbkIsUUFBSSxJQUFJLEdBQUcsR0FBRyxDQUFDLEdBQUcsQ0FBQyxTQUFTLENBQUMsWUFBWSxDQUFDLENBQ3JDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztBQUNoQixRQUFJLENBQ0QsS0FBSyxFQUFFLENBQ1AsTUFBTSxDQUFDLFFBQVEsQ0FBQyxDQUNkLElBQUksQ0FBQyxPQUFPLEVBQUUsV0FBVyxDQUFDLENBQUM7QUFDaEMsUUFBSSxDQUNELFVBQVUsRUFBRSxDQUNWLEtBQUssQ0FBQyxVQUFTLENBQUMsRUFBQyxDQUFDLEVBQUU7QUFBRSxhQUFPLENBQUMsR0FBRyxFQUFFLENBQUM7S0FBQyxDQUFDLENBQ3RDLElBQUksQ0FBQztBQUNKLE9BQUMsRUFBTyxHQUFHO0FBQ1gsUUFBRSxFQUFNLEdBQUcsQ0FBQyxJQUFJO0FBQ2hCLFFBQUUsRUFBTSxHQUFHLENBQUMsSUFBSTtLQUNqQixDQUFDLENBQ0QsS0FBSyxDQUFDLE1BQU0sRUFBRSxVQUFTLENBQUMsRUFBRTtBQUFFLGFBQU8sR0FBRyxDQUFDLFVBQVUsQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7S0FBRSxDQUFDLENBQ3BFLElBQUksQ0FBQyxLQUFLLEVBQUUsVUFBUyxDQUFDLEVBQUMsQ0FBQyxFQUFFO0FBQ3pCLFVBQUksQ0FBQyxLQUFLLElBQUksQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFO0FBQ3pCLGdCQUFRLEVBQUUsQ0FBQztPQUNaO0tBQ0YsQ0FBQyxDQUFDO0FBQ1AsYUFBUyxRQUFRLEdBQUc7QUFDbEIsVUFBSSxHQUFHLEdBQUcsRUFBRSxDQUFDLEdBQUcsQ0FBQyxZQUFZLENBQUMsSUFBSSxFQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsQ0FBQztBQUMvQyxVQUFJLEdBQUcsR0FBRyxFQUFFLENBQUMsR0FBRyxDQUFDLFlBQVksQ0FBQyxJQUFJLEVBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxDQUFDO0FBQy9DLFVBQUksYUFBYSxHQUFHLEdBQUcsQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUN2QyxJQUFJLENBQUM7QUFDSixVQUFFLEVBQUcsR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUM7QUFDcEIsVUFBRSxFQUFHLEdBQUcsQ0FBQyxNQUFNLENBQUMsR0FBRyxHQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLEdBQUcsR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQztBQUNoRCxVQUFFLEVBQUcsR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUM7QUFDcEIsVUFBRSxFQUFHLEdBQUcsQ0FBQyxNQUFNLENBQUMsR0FBRyxHQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLEdBQUcsR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQztBQUNoRCxnQkFBUSxFQUFHLFNBQVM7QUFDcEIsc0JBQWMsRUFBRyxDQUFDO09BQ25CLENBQUMsQ0FBQztLQUNOOztBQUVELE9BQUcsQ0FBQyxLQUFLLEdBQUcsS0FBSyxFQUNqQixHQUFHLENBQUMsS0FBSyxHQUFHLENBQUMsQ0FBQyxFQUFDLENBQUMsQ0FBQyxFQUNqQixHQUFHLENBQUMsUUFBUSxHQUFHLEVBQUUsRUFDakIsR0FBRyxDQUFDLFlBQVksR0FBRyxFQUFFLENBQUM7QUFDdEIsUUFBSSxDQUFDLEdBQUcsQ0FBQztRQUNMLFVBQVUsR0FBRyxTQUFiLFVBQVUsR0FBYztBQUN0QixhQUFPLEdBQUcsQ0FBQyxRQUFRLENBQUMsQ0FBQyxHQUFDLENBQUMsQ0FBQyxHQUN0QixHQUFHLENBQUMsUUFBUSxDQUFDLENBQUMsR0FBQyxDQUFDLENBQUMsR0FBRyxHQUFHLENBQUMsUUFBUSxDQUFDLENBQUMsR0FBQyxDQUFDLENBQUMsR0FDckMsQ0FBQyxDQUFDO0tBQ0wsQ0FBQzs7QUFFTixPQUFHO0FBQ0QsU0FBRyxDQUFDLEtBQUssR0FBRyxlQUFlLENBQUMsSUFBSSxFQUFDLEdBQUcsQ0FBQyxLQUFLLEVBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFDO0FBQ3RELFNBQUcsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxJQUFJLEVBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7QUFDckMsU0FBRyxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFDO0FBQ2pDLE9BQUMsRUFBRSxDQUFDO0tBQ0wsUUFBUSxVQUFVLEVBQUUsR0FBRyxLQUFLLEVBQUU7OztHQUdoQyxDQUFDLENBQUM7Q0FDTixDQUFDLENBQUEiLCJmaWxlIjoic3JjL2pzL3NhbXBsZXNjYXR0ZXJwbG90LmpzIiwic291cmNlc0NvbnRlbnQiOlsidmFyIHNhbXBsZWJ1Y2tldCA9IHt9OyAvLyBvdXIgZ2xvYmFsIHZhcmlhYmxlXG5zYW1wbGVidWNrZXQuc2FtcGxlTGluZWFyUmVncmVzc2lvbiA9IHt9O1xudmFyIHNsciA9IHNhbXBsZWJ1Y2tldC5zYW1wbGVMaW5lYXJSZWdyZXNzaW9uO1xuXG4vLyBTQ0FUVEVSIFBMT1QgU0VUVVBcblxuc2FtcGxlYnVja2V0LnNhbXBsZVNjYXR0ZXJwbG90ID0ge307IC8vIGJ1Y2tldCBmb3IgdGhlIHNjYXR0ZXIgcGxvdFxudmFyIHNzcCA9IHNhbXBsZWJ1Y2tldC5zYW1wbGVTY2F0dGVycGxvdDsgLy8gY29udmVuaWVuY2UgdmFyaWFibGVcbnNzcC5tYXJnaW4gPSB7IHRvcDogMjAsIHJpZ2h0OiAyMCwgYm90dG9tOiAzMCwgbGVmdDogNDAgfTtcbnNzcC53aWR0aCA9IDQ4MCAtIHNzcC5tYXJnaW4ubGVmdCAtIHNzcC5tYXJnaW4ucmlnaHQ7XG5zc3AuaGVpZ2h0PSAyNTAgLSBzc3AubWFyZ2luLnRvcCAtIHNzcC5tYXJnaW4uYm90dG9tO1xuXG4vLyBzZXR1cCB4XG5zc3AueFZhbHVlID0gZnVuY3Rpb24oZCkgeyByZXR1cm4gZC54OyB9OyAvLyBkYXRhIC0+IHZhbHVlXG5zc3AueFNjYWxlID0gZDMuc2NhbGUubGluZWFyKClcbiAgLmRvbWFpbihbMCwxMDBdKVxuICAucmFuZ2UoWzAsIHNzcC53aWR0aF0pOyAvLyB2YWx1ZSAtPiBkaXNzcGxheVxuc3NwLnhNYXAgPSBmdW5jdGlvbihkKSB7IHJldHVybiBzc3AueFNjYWxlKHNzcC54VmFsdWUoZCkpOyB9OyAvLyBkYXRhIC0+IGRpc3NwbGF5XG5zc3AueEF4aXMgPSBkMy5zdmcuYXhpcygpXG4gIC5zY2FsZShzc3AueFNjYWxlKVxuICAub3JpZW50KFwiYm90dG9tXCIpO1xuXG4vLyBzZXR1cCB5XG5zc3AueVZhbHVlID0gZnVuY3Rpb24oZCkgeyByZXR1cm4gZC55OyB9OyAvLyBkYXRhIC0+IHZhbHVlXG5zc3AueVNjYWxlID0gZDMuc2NhbGUubGluZWFyKClcbiAgLmRvbWFpbihbMCwxMDBdKVxuICAucmFuZ2UoW3NzcC5oZWlnaHQsMF0pOyAvLyB2YWx1ZSAtPiBkaXNzcGxheVxuc3NwLnlNYXAgPSBmdW5jdGlvbihkKSB7IHJldHVybiBzc3AueVNjYWxlKHNzcC55VmFsdWUoZCkpOyB9OyAvLyBkYXRhIC0+IGRpc3NwbGF5XG5zc3AueUF4aXMgPSBkMy5zdmcuYXhpcygpXG4gIC5zY2FsZShzc3AueVNjYWxlKVxuICAub3JpZW50KFwibGVmdFwiKTtcblxuLy8gc2V0dXAgY29sb3Igc2NhbGVcbnNzcC5jb2xvclNjYWxlID0gZDMuc2NhbGUubGluZWFyKClcbiAgLnJhbmdlKFtcImhzbCgyMCw5MCUsNDAlKVwiLCBcImhzbCgxODAsNjAlLDQwJSlcIl0pO1xuXG4vLyBhZGQgZ3JhcGggY2FudmFzIHRvICNzY2F0dGVycGxvdCBkaXZcbnNzcC5zdmcgPSBkMy5zZWxlY3QoXCIjc2FtcGxlc2NhdHRlcnBsb3RcIikuYXBwZW5kKFwic3ZnXCIpXG4gICAgLmF0dHIoXCJ3aWR0aFwiLCBzc3Aud2lkdGggKyBzc3AubWFyZ2luLmxlZnQgKyBzc3AubWFyZ2luLnJpZ2h0KVxuICAgIC5hdHRyKFwiaGVpZ2h0XCIsIHNzcC5oZWlnaHQgKyBzc3AubWFyZ2luLmJvdHRvbSArIHNzcC5tYXJnaW4udG9wKVxuICAuYXBwZW5kKFwiZ1wiKVxuICAgIC5hdHRyKFwidHJhbnNmb3JtXCIsIGB0cmFuc2xhdGUoJHtzc3AubWFyZ2luLmxlZnR9LCR7c3NwLm1hcmdpbi50b3B9KWApO1xuXG4vLyB4LWF4aXNcbnNzcC5zdmcuYXBwZW5kKFwiZ1wiKVxuICAgIC5hdHRyKHtcbiAgICAgIGNsYXNzIDogXCJ4IGF4aXNcIixcbiAgICAgIHRyYW5zZm9ybSA6IGB0cmFuc2xhdGUoMCwke3NzcC5oZWlnaHR9KWBcbiAgICB9KVxuICAgIC5jYWxsKHNzcC54QXhpcylcbiAgLmFwcGVuZChcInRleHRcIilcbiAgICAuYXR0cih7XG4gICAgICBjbGFzcyA6IFwibGFiZWxcIixcbiAgICAgIHggICAgIDogc3NwLndpZHRoLFxuICAgICAgeSAgICAgOiAtNlxuICAgIH0pXG4gICAgLnN0eWxlKFwidGV4dC1hbmNob3JcIiwgXCJlbmRcIilcbiAgICAudGV4dChcIlBvcHVsYXRpb24gKDEwLDAwMHMpXCIpO1xuXG4vLyB5LWF4aXNcbnNzcC5zdmcuYXBwZW5kKFwiZ1wiKVxuICAgIC5hdHRyKFwiY2xhc3NcIiwgXCJ5IGF4aXNcIilcbiAgICAuY2FsbChzc3AueUF4aXMpXG4gIC5hcHBlbmQoXCJ0ZXh0XCIpXG4gICAgLmF0dHIoe1xuICAgICAgY2xhc3MgOiBcImxhYmVsXCIsXG4gICAgICB0cmFuc2Zvcm0gOiBcInJvdGF0ZSgtOTApXCIsXG4gICAgICB5ICAgICA6IDYsXG4gICAgICBkeSAgICA6IFwiLjcxZW1cIlxuICAgIH0pXG4gICAgLnN0eWxlKFwidGV4dC1hbmNob3JcIiwgXCJlbmRcIilcbiAgICAudGV4dChcIlByb2ZpdCAoJDEwLDAwMHMpXCIpO1xuXG4vLyBsb2FkIGRhdGFcbmQzLnNlbGVjdChcIiNydW5cIilcbiAgLm9uKFwiY2xpY2tcIiwgZnVuY3Rpb24oKSB7XG5cbiAgICBkMy5jc3YoJy4vZGF0YS5jc3YnLFxuICAgICAgZnVuY3Rpb24oZXJyLCBkYXRhKSB7XG4gICAgICAgIGlmKGVycikgdGhyb3cgZXJyO1xuXG4gICAgICAgIC8vIGNoYW5nZSBmcm9tIENTViBzdHJpbmcgaW50byBudW1iZXIgZm9ybWF0XG4gICAgICAgIGRhdGEuZm9yRWFjaChmdW5jdGlvbihkKSB7XG4gICAgICAgICAgZC54ID0gK2QucG9wdWxhdGlvbjtcbiAgICAgICAgICBkLnkgICAgID0gK2QucHJvZml0O1xuICAgICAgICB9KTtcbiAgICAgICAgc2FtcGxlYnVja2V0LmRhdGEgPSBkYXRhO1xuXG4gICAgICAgIC8vIENIQU5HRVMgVE8gU0NBVFRFUiBQTE9UXG5cbiAgICAgICAgLy8gYnVmZmVyIGFkZGVkIHRvIGRhdGEgZG9tYWluIHRvIHByZXZlbnQgb3ZlcmxhcHBpbmcgYXhpc1xuICAgICAgICBzc3AueFNjYWxlLmRvbWFpbihbZDMubWluKGRhdGEsc3NwLnhWYWx1ZSktMSwgZDMubWF4KGRhdGEsc3NwLnhWYWx1ZSkrMV0pO1xuICAgICAgICBzc3AueVNjYWxlLmRvbWFpbihbZDMubWluKGRhdGEsc3NwLnlWYWx1ZSktMSwgZDMubWF4KGRhdGEsc3NwLnlWYWx1ZSkrMV0pO1xuICAgICAgICBzc3AuY29sb3JTY2FsZS5kb21haW4oW2QzLm1pbihkYXRhLHNzcC55VmFsdWUpLTEsZDMubWF4KGRhdGEsc3NwLnlWYWx1ZSkrMV0pLm5pY2UoKTtcblxuICAgICAgICAvLyBjaGFuZ2UgYXhlcyBsYWJlbHNcbiAgICAgICAgc3NwLnN2Zy5zZWxlY3QoXCIueC5heGlzXCIpXG4gICAgICAgICAgLnRyYW5zaXRpb24oKVxuICAgICAgICAgIC5kdXJhdGlvbigxMDAwKVxuICAgICAgICAgIC5jYWxsKHNzcC54QXhpcyk7XG5cbiAgICAgICAgc3NwLnN2Zy5zZWxlY3QoXCIueS5heGlzXCIpXG4gICAgICAgICAgLnRyYW5zaXRpb24oKVxuICAgICAgICAgIC5kdXJhdGlvbigxMDAwKVxuICAgICAgICAgIC5jYWxsKHNzcC55QXhpcyk7XG5cbiAgICAgICAgdmFyIGRvdHMgPSBzc3Auc3ZnLnNlbGVjdEFsbChcIi5zYW1wbGVkb3RcIilcbiAgICAgICAgICAgIC5kYXRhKGRhdGEpO1xuICAgICAgICBkb3RzXG4gICAgICAgICAgLmVudGVyKClcbiAgICAgICAgICAuYXBwZW5kKFwiY2lyY2xlXCIpXG4gICAgICAgICAgICAuYXR0cihcImNsYXNzXCIsIFwic2FtcGxlZG90XCIpO1xuICAgICAgICBkb3RzXG4gICAgICAgICAgLnRyYW5zaXRpb24oKVxuICAgICAgICAgICAgLmRlbGF5KGZ1bmN0aW9uKGQsaSkgeyByZXR1cm4gaSAqIDUwO30pXG4gICAgICAgICAgICAuYXR0cih7XG4gICAgICAgICAgICAgIHIgICAgIDogMy41LFxuICAgICAgICAgICAgICBjeCAgICA6IHNzcC54TWFwLFxuICAgICAgICAgICAgICBjeSAgICA6IHNzcC55TWFwXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLnN0eWxlKFwiZmlsbFwiLCBmdW5jdGlvbihkKSB7IHJldHVybiBzc3AuY29sb3JTY2FsZShzc3AueVZhbHVlKGQpKTsgfSlcbiAgICAgICAgICAgIC5lYWNoKFwiZW5kXCIsIGZ1bmN0aW9uKGQsaSkge1xuICAgICAgICAgICAgICBpZiAoaSA9PT0gZGF0YS5sZW5ndGggLSAxKSB7XG4gICAgICAgICAgICAgICAgZHJhd0xpbmUoKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIGZ1bmN0aW9uIGRyYXdMaW5lKCkge1xuICAgICAgICAgIHZhciBtYXggPSBkMy5tYXgoc2FtcGxlYnVja2V0LmRhdGEsc3NwLnhWYWx1ZSk7XG4gICAgICAgICAgdmFyIG1pbiA9IGQzLm1pbihzYW1wbGVidWNrZXQuZGF0YSxzc3AueFZhbHVlKTtcbiAgICAgICAgICB2YXIgbGluZU9mQmVzdEZpdCA9IHNzcC5zdmcuYXBwZW5kKFwibGluZVwiKVxuICAgICAgICAgICAgLmF0dHIoe1xuICAgICAgICAgICAgICB4MSA6IHNzcC54U2NhbGUobWluKSxcbiAgICAgICAgICAgICAgeTEgOiBzc3AueVNjYWxlKG1pbipzbHIudGhldGFbMV0gKyBzbHIudGhldGFbMF0pLFxuICAgICAgICAgICAgICB4MiA6IHNzcC54U2NhbGUobWF4KSxcbiAgICAgICAgICAgICAgeTIgOiBzc3AueVNjYWxlKG1heCpzbHIudGhldGFbMV0gKyBzbHIudGhldGFbMF0pLFxuICAgICAgICAgICAgICBcInN0cm9rZVwiIDogXCIjMUNERUM0XCIsXG4gICAgICAgICAgICAgIFwic3Ryb2tlLXdpZHRoXCIgOiAyXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIHNsci5hbHBoYSA9IDAuMDA0LFxuICAgICAgICBzbHIudGhldGEgPSBbMCwwXSxcbiAgICAgICAgc2xyLmpIaXN0b3J5ID0gW10sXG4gICAgICAgIHNsci50aGV0YUhpc3RvcnkgPSBbXTtcbiAgICAgICAgdmFyIGkgPSAwLFxuICAgICAgICAgICAgZGlmZmVyZW5jZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICByZXR1cm4gc2xyLmpIaXN0b3J5W2ktMl0gP1xuICAgICAgICAgICAgICAgIHNsci5qSGlzdG9yeVtpLTJdIC0gc2xyLmpIaXN0b3J5W2ktMV0gOlxuICAgICAgICAgICAgICAgIDE7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgIGRvIHtcbiAgICAgICAgICBzbHIudGhldGEgPSBncmFkaWVudERlc2NlbnQoZGF0YSxzbHIuYWxwaGEsc2xyLnRoZXRhKTtcbiAgICAgICAgICBzbHIuakhpc3RvcnkucHVzaChKKGRhdGEsc2xyLnRoZXRhKSk7XG4gICAgICAgICAgc2xyLnRoZXRhSGlzdG9yeS5wdXNoKHNsci50aGV0YSk7XG4gICAgICAgICAgaSsrO1xuICAgICAgICB9IHdoaWxlIChkaWZmZXJlbmNlKCkgPiAuMDAwMSk7XG5cbiAgICAgICAgLy8gZGVidWdnZXI7XG4gICAgICB9KTtcbiAgfSlcbiJdfQ==
