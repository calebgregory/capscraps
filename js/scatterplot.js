"use strict";

var bucket = {}; // our global variable
bucket.linearRegression = {};
var lr = bucket.linearRegression;

bucket.data = [{ x: 5, y: 100 - 4 }, { x: 15, y: 100 - 20 }, { x: 30, y: 100 - 45 }, { x: 12, y: 100 - 15 }, { x: 60, y: 100 - 70 }, { x: 55, y: 100 - 69 }, { x: 29, y: 100 - 30 }, { x: 44, y: 100 - 40 }, { x: 78, y: 100 - 89 }, { x: 90, y: 100 - 95 }, { x: 69, y: 100 - 77 }, { x: 74, y: 100 - 74 }, { x: 60, y: 100 - 66 }, { x: 100, y: 100 - 96 }];

// SCATTER PLOT SETUP

bucket.scatterplot = {}; // bucket for the scatter plot
var sp = bucket.scatterplot; // convenience variable
sp.margin = { top: 20, right: 20, bottom: 30, left: 40 };
sp.width = 600 - sp.margin.left - sp.margin.right;
sp.height = 313 - sp.margin.top - sp.margin.bottom;

// setup x
sp.xValue = function (d) {
  return d.x;
}; // data -> value
sp.xScale = d3.scale.linear().domain([0, 100]).range([0, sp.width]); // value -> display
sp.xMap = function (d) {
  return sp.xScale(sp.xValue(d));
}; // data -> display
sp.xAxis = d3.svg.axis().scale(sp.xScale).orient("bottom");

// setup y
sp.yValue = function (d) {
  return d.y;
}; // data -> value
sp.yScale = d3.scale.linear().domain([0, 100]).range([sp.height, 0]); // value -> display
sp.yMap = function (d) {
  return sp.yScale(sp.yValue(d));
}; // data -> display
sp.yAxis = d3.svg.axis().scale(sp.yScale).orient("left");

// setup color scale
sp.colorScale = d3.scale.linear().range(["hsl(20,90%,40%)", "hsl(180,60%,40%)"]);

// add graph canvas to #scatterplot div
sp.svg = d3.select("#scatterplot").append("svg").attr("width", sp.width + sp.margin.left + sp.margin.right).attr("height", sp.height + sp.margin.bottom + sp.margin.top).append("g").attr("transform", "translate(" + sp.margin.left + "," + sp.margin.top + ")");

// x-axis
sp.svg.append("g").attr({
  "class": "x axis",
  transform: "translate(0," + sp.height + ")"
}).call(sp.xAxis).append("text").attr({
  "class": "label",
  x: sp.width,
  y: -6
}).style("text-anchor", "end").text("x");

// y-axis
sp.svg.append("g").attr("class", "y axis").call(sp.yAxis).append("text").attr({
  "class": "label",
  transform: "rotate(-90)",
  y: 6,
  dy: ".71em"
}).style("text-anchor", "end").text("y");

// CHANGES TO SCATTER PLOT
bucket.update = function () {

  // buffer added to data domain to prevent overlapping axis
  //  sp.xScale.domain([d3.min(data,sp.xValue)-1, d3.max(data,sp.xValue)+1]);
  //  sp.yScale.domain([d3.min(data,sp.yValue)-1, d3.max(data,sp.yValue)+1]);
  sp.xScale.domain([0, 100]);
  sp.yScale.domain([0, 100]);
  sp.colorScale.domain([d3.min(bucket.data, sp.yValue) - 1, d3.max(bucket.data, sp.yValue) + 1]).nice();

  // update axes
  sp.svg.select(".x.axis").transition().duration(1000).call(sp.xAxis);

  sp.svg.select(".y.axis").transition().duration(1000).call(sp.yAxis);

  // dots
  var dots = sp.svg.selectAll(".dot").data(bucket.data).attr({
    "class": "dot",
    r: 3.5,
    cx: sp.xMap,
    cy: sp.yMap
  }).style("fill", function (d) {
    return sp.colorScale(sp.yValue(d));
  });

  dots.enter().append("circle").attr({
    "class": "dot",
    r: 3.5,
    cx: sp.xMap,
    cy: sp.yMap
  }).style("fill", function (d) {
    return sp.colorScale(sp.yValue(d));
  }).on("click", function (d, i) {
    if (bucket.data.length > 2) {
      bucket.data.splice(i, 1);
    } else {
      alert("hey man, not cool. \n\neveryone knows there have to exist at least two points for a line to exist.");
    }
    bucket.update();
  });

  dots.exit().remove();

  // calculate theta values using gradient descent
  // begins with a "guess", which is theta_0 = 0, theta_1 = 0
  // a.k.a. - the x-axis (y = 0 * x + 0 => y = 0)
  lr.alpha = 0.0003, lr.theta = lr.theta || [100, 0], lr.jHistory = [], lr.thetaHistory = [];
  var i = 0,
      difference = function difference() {
    return lr.jHistory[i - 2] ? lr.jHistory[i - 2] - lr.jHistory[i - 1] : 1;
  };

  do {
    lr.theta = gradientDescent(bucket.data, lr.alpha, lr.theta);
    lr.jHistory.push(J(bucket.data, lr.theta));
    lr.thetaHistory.push(lr.theta);
    i++;
  } while (difference() > 0.001);

  var maxX = d3.max(bucket.data, sp.xValue);
  // var minX = d3.min(bucket.data,sp.xValue);
  var minX = 0;
  sp.svg.selectAll("line").remove();
  var lineOfBestFit = sp.svg.append("line").attr({
    x1: sp.xScale(minX),
    y1: sp.yScale(minX * lr.theta[1] + lr.theta[0]),
    x2: sp.xScale(maxX),
    y2: sp.yScale(maxX * lr.theta[1] + lr.theta[0]),
    "stroke": "#1CDEC4",
    "stroke-width": 2
  });

  // display the equation for the line of best fit
  var docFrag = document.createDocumentFragment();
  var p = document.createElement("P");
  docFrag.appendChild(p);
  var pText = document.createTextNode("y = " + lr.theta[1].toPrecision(3) + "x + " + lr.theta[0].toPrecision(3));
  p.appendChild(pText);
  $("#equation").empty();
  $("#equation").append(p);
};
bucket.update();

// adds a new, randomly generated datum to graph
d3.select("#add").on("click", function () {
  var newDot = {};
  newDot.x = Math.floor(Math.random() * 100);
  newDot.y = Math.floor(Math.random() * 100);
  bucket.data.push(newDot);
  bucket.update();
});
//# sourceMappingURL=data:application/json;base64,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QUMsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsR0FBRyxHQUFHLENBQUMsQ0FBQztBQUMzQyxRQUFNLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRSxHQUFHLEdBQUcsQ0FBQyxDQUFDO0FBQzNDLFFBQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDO0FBQ3pCLFFBQU0sQ0FBQyxNQUFNLEVBQUUsQ0FBQztDQUNqQixDQUFDLENBQUMiLCJmaWxlIjoic3JjL2pzL3NjYXR0ZXJwbG90LmpzIiwic291cmNlc0NvbnRlbnQiOlsidmFyIGJ1Y2tldCA9IHt9OyAvLyBvdXIgZ2xvYmFsIHZhcmlhYmxlXG5idWNrZXQubGluZWFyUmVncmVzc2lvbiA9IHt9O1xudmFyIGxyID0gYnVja2V0LmxpbmVhclJlZ3Jlc3Npb247XG5cbmJ1Y2tldC5kYXRhID0gW1xuICB7IHggOiA1ICAgLCB5IDogMTAwLTQgfSxcbiAgeyB4IDogMTUgICwgeSA6IDEwMC0yMH0sXG4gIHsgeCA6IDMwICAsIHkgOiAxMDAtNDV9LFxuICB7IHggOiAxMiAgLCB5IDogMTAwLTE1fSxcbiAgeyB4IDogNjAgICwgeSA6IDEwMC03MH0sXG4gIHsgeCA6IDU1ICAsIHkgOiAxMDAtNjl9LFxuICB7IHggOiAyOSAgLCB5IDogMTAwLTMwfSxcbiAgeyB4IDogNDQgICwgeSA6IDEwMC00MH0sXG4gIHsgeCA6IDc4ICAsIHkgOiAxMDAtODl9LFxuICB7IHggOiA5MCAgLCB5IDogMTAwLTk1fSxcbiAgeyB4IDogNjkgICwgeSA6IDEwMC03N30sXG4gIHsgeCA6IDc0ICAsIHkgOiAxMDAtNzR9LFxuICB7IHggOiA2MCAgLCB5IDogMTAwLTY2fSxcbiAgeyB4IDogMTAwICwgeSA6IDEwMC05Nn1cbl07XG5cbi8vIFNDQVRURVIgUExPVCBTRVRVUFxuXG5idWNrZXQuc2NhdHRlcnBsb3QgPSB7fTsgLy8gYnVja2V0IGZvciB0aGUgc2NhdHRlciBwbG90XG52YXIgc3AgPSBidWNrZXQuc2NhdHRlcnBsb3Q7IC8vIGNvbnZlbmllbmNlIHZhcmlhYmxlXG5zcC5tYXJnaW4gPSB7IHRvcDogMjAsIHJpZ2h0OiAyMCwgYm90dG9tOiAzMCwgbGVmdDogNDAgfTtcbnNwLndpZHRoID0gNjAwIC0gc3AubWFyZ2luLmxlZnQgLSBzcC5tYXJnaW4ucmlnaHQ7XG5zcC5oZWlnaHQ9IDMxMyAtIHNwLm1hcmdpbi50b3AgLSBzcC5tYXJnaW4uYm90dG9tO1xuXG4vLyBzZXR1cCB4XG5zcC54VmFsdWUgPSBmdW5jdGlvbihkKSB7IHJldHVybiBkLng7IH07IC8vIGRhdGEgLT4gdmFsdWVcbnNwLnhTY2FsZSA9IGQzLnNjYWxlLmxpbmVhcigpXG4gIC5kb21haW4oWzAsMTAwXSlcbiAgLnJhbmdlKFswLCBzcC53aWR0aF0pOyAvLyB2YWx1ZSAtPiBkaXNwbGF5XG5zcC54TWFwID0gZnVuY3Rpb24oZCkgeyByZXR1cm4gc3AueFNjYWxlKHNwLnhWYWx1ZShkKSk7IH07IC8vIGRhdGEgLT4gZGlzcGxheVxuc3AueEF4aXMgPSBkMy5zdmcuYXhpcygpXG4gIC5zY2FsZShzcC54U2NhbGUpXG4gIC5vcmllbnQoXCJib3R0b21cIik7XG5cbi8vIHNldHVwIHlcbnNwLnlWYWx1ZSA9IGZ1bmN0aW9uKGQpIHsgcmV0dXJuIGQueTsgfTsgLy8gZGF0YSAtPiB2YWx1ZVxuc3AueVNjYWxlID0gZDMuc2NhbGUubGluZWFyKClcbiAgLmRvbWFpbihbMCwxMDBdKVxuICAucmFuZ2UoW3NwLmhlaWdodCwwXSk7IC8vIHZhbHVlIC0+IGRpc3BsYXlcbnNwLnlNYXAgPSBmdW5jdGlvbihkKSB7IHJldHVybiBzcC55U2NhbGUoc3AueVZhbHVlKGQpKTsgfTsgLy8gZGF0YSAtPiBkaXNwbGF5XG5zcC55QXhpcyA9IGQzLnN2Zy5heGlzKClcbiAgLnNjYWxlKHNwLnlTY2FsZSlcbiAgLm9yaWVudChcImxlZnRcIik7XG5cbi8vIHNldHVwIGNvbG9yIHNjYWxlXG5zcC5jb2xvclNjYWxlID0gZDMuc2NhbGUubGluZWFyKClcbiAgLnJhbmdlKFtcImhzbCgyMCw5MCUsNDAlKVwiLCBcImhzbCgxODAsNjAlLDQwJSlcIl0pO1xuXG4vLyBhZGQgZ3JhcGggY2FudmFzIHRvICNzY2F0dGVycGxvdCBkaXZcbnNwLnN2ZyA9IGQzLnNlbGVjdChcIiNzY2F0dGVycGxvdFwiKS5hcHBlbmQoXCJzdmdcIilcbiAgICAuYXR0cihcIndpZHRoXCIsIHNwLndpZHRoICsgc3AubWFyZ2luLmxlZnQgKyBzcC5tYXJnaW4ucmlnaHQpXG4gICAgLmF0dHIoXCJoZWlnaHRcIiwgc3AuaGVpZ2h0ICsgc3AubWFyZ2luLmJvdHRvbSArIHNwLm1hcmdpbi50b3ApXG4gIC5hcHBlbmQoXCJnXCIpXG4gICAgLmF0dHIoXCJ0cmFuc2Zvcm1cIiwgYHRyYW5zbGF0ZSgke3NwLm1hcmdpbi5sZWZ0fSwke3NwLm1hcmdpbi50b3B9KWApO1xuXG4vLyB4LWF4aXNcbnNwLnN2Zy5hcHBlbmQoXCJnXCIpXG4gICAgLmF0dHIoe1xuICAgICAgY2xhc3MgOiBcInggYXhpc1wiLFxuICAgICAgdHJhbnNmb3JtIDogYHRyYW5zbGF0ZSgwLCR7c3AuaGVpZ2h0fSlgXG4gICAgfSlcbiAgICAuY2FsbChzcC54QXhpcylcbiAgLmFwcGVuZChcInRleHRcIilcbiAgICAuYXR0cih7XG4gICAgICBjbGFzcyA6IFwibGFiZWxcIixcbiAgICAgIHggICAgIDogc3Aud2lkdGgsXG4gICAgICB5ICAgICA6IC02XG4gICAgfSlcbiAgICAuc3R5bGUoXCJ0ZXh0LWFuY2hvclwiLCBcImVuZFwiKVxuICAgIC50ZXh0KFwieFwiKTtcblxuLy8geS1heGlzXG5zcC5zdmcuYXBwZW5kKFwiZ1wiKVxuICAgIC5hdHRyKFwiY2xhc3NcIiwgXCJ5IGF4aXNcIilcbiAgICAuY2FsbChzcC55QXhpcylcbiAgLmFwcGVuZChcInRleHRcIilcbiAgICAuYXR0cih7XG4gICAgICBjbGFzcyA6IFwibGFiZWxcIixcbiAgICAgIHRyYW5zZm9ybSA6IFwicm90YXRlKC05MClcIixcbiAgICAgIHkgICAgIDogNixcbiAgICAgIGR5ICAgIDogXCIuNzFlbVwiXG4gICAgfSlcbiAgICAuc3R5bGUoXCJ0ZXh0LWFuY2hvclwiLCBcImVuZFwiKVxuICAgIC50ZXh0KFwieVwiKTtcblxuLy8gQ0hBTkdFUyBUTyBTQ0FUVEVSIFBMT1RcbmJ1Y2tldC51cGRhdGUgPSBmdW5jdGlvbigpIHtcblxuICAvLyBidWZmZXIgYWRkZWQgdG8gZGF0YSBkb21haW4gdG8gcHJldmVudCBvdmVybGFwcGluZyBheGlzXG4vLyAgc3AueFNjYWxlLmRvbWFpbihbZDMubWluKGRhdGEsc3AueFZhbHVlKS0xLCBkMy5tYXgoZGF0YSxzcC54VmFsdWUpKzFdKTtcbi8vICBzcC55U2NhbGUuZG9tYWluKFtkMy5taW4oZGF0YSxzcC55VmFsdWUpLTEsIGQzLm1heChkYXRhLHNwLnlWYWx1ZSkrMV0pO1xuICBzcC54U2NhbGUuZG9tYWluKFswLDEwMF0pO1xuICBzcC55U2NhbGUuZG9tYWluKFswLDEwMF0pO1xuICBzcC5jb2xvclNjYWxlLmRvbWFpbihbZDMubWluKGJ1Y2tldC5kYXRhLHNwLnlWYWx1ZSktMSxkMy5tYXgoYnVja2V0LmRhdGEsc3AueVZhbHVlKSsxXSkubmljZSgpO1xuXG4gIC8vIHVwZGF0ZSBheGVzXG4gIHNwLnN2Zy5zZWxlY3QoXCIueC5heGlzXCIpXG4gICAgLnRyYW5zaXRpb24oKVxuICAgIC5kdXJhdGlvbigxMDAwKVxuICAgIC5jYWxsKHNwLnhBeGlzKTtcblxuICBzcC5zdmcuc2VsZWN0KFwiLnkuYXhpc1wiKVxuICAgIC50cmFuc2l0aW9uKClcbiAgICAuZHVyYXRpb24oMTAwMClcbiAgICAuY2FsbChzcC55QXhpcyk7XG5cbiAgLy8gZG90c1xuICB2YXIgZG90cyA9IHNwLnN2Zy5zZWxlY3RBbGwoXCIuZG90XCIpXG4gICAgLmRhdGEoYnVja2V0LmRhdGEpXG4gICAgLmF0dHIoe1xuICAgICAgY2xhc3MgOiBcImRvdFwiLFxuICAgICAgciAgICAgOiAzLjUsXG4gICAgICBjeCAgICA6IHNwLnhNYXAsXG4gICAgICBjeSAgICA6IHNwLnlNYXBcbiAgICB9KVxuICAgIC5zdHlsZShcImZpbGxcIiwgZnVuY3Rpb24oZCkgeyByZXR1cm4gc3AuY29sb3JTY2FsZShzcC55VmFsdWUoZCkpOyB9KVxuXG4gIGRvdHMuZW50ZXIoKVxuICAgIC5hcHBlbmQoXCJjaXJjbGVcIilcbiAgICAuYXR0cih7XG4gICAgICBjbGFzcyA6IFwiZG90XCIsXG4gICAgICByICAgICA6IDMuNSxcbiAgICAgIGN4ICAgIDogc3AueE1hcCxcbiAgICAgIGN5ICAgIDogc3AueU1hcFxuICAgIH0pXG4gICAgLnN0eWxlKFwiZmlsbFwiLCBmdW5jdGlvbihkKSB7IHJldHVybiBzcC5jb2xvclNjYWxlKHNwLnlWYWx1ZShkKSk7IH0pXG4gICAgLm9uKFwiY2xpY2tcIiwgZnVuY3Rpb24oZCxpKSB7XG4gICAgICBpZiAoYnVja2V0LmRhdGEubGVuZ3RoID4gMikge1xuICAgICAgICBidWNrZXQuZGF0YS5zcGxpY2UoaSwxKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGFsZXJ0KCdoZXkgbWFuLCBub3QgY29vbC4gXFxuXFxuZXZlcnlvbmUga25vd3MgdGhlcmUgaGF2ZSB0byBleGlzdCBhdCBsZWFzdCB0d28gcG9pbnRzIGZvciBhIGxpbmUgdG8gZXhpc3QuJylcbiAgICAgIH1cbiAgICAgIGJ1Y2tldC51cGRhdGUoKTtcbiAgICB9KTtcblxuICBkb3RzLmV4aXQoKS5yZW1vdmUoKTtcblxuICAvLyBjYWxjdWxhdGUgdGhldGEgdmFsdWVzIHVzaW5nIGdyYWRpZW50IGRlc2NlbnRcbiAgLy8gYmVnaW5zIHdpdGggYSBcImd1ZXNzXCIsIHdoaWNoIGlzIHRoZXRhXzAgPSAwLCB0aGV0YV8xID0gMFxuICAvLyBhLmsuYS4gLSB0aGUgeC1heGlzICh5ID0gMCAqIHggKyAwID0+IHkgPSAwKVxuICBsci5hbHBoYSA9IDAuMDAwMyxcbiAgbHIudGhldGEgPSBsci50aGV0YSB8fCBbMTAwLDBdLFxuICBsci5qSGlzdG9yeSA9IFtdLFxuICBsci50aGV0YUhpc3RvcnkgPSBbXTtcbiAgdmFyIGkgPSAwLFxuICAgICAgZGlmZmVyZW5jZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gbHIuakhpc3RvcnlbaS0yXSA/XG4gICAgICAgICAgbHIuakhpc3RvcnlbaS0yXSAtIGxyLmpIaXN0b3J5W2ktMV0gOlxuICAgICAgICAgIDE7XG4gICAgICB9O1xuXG4gIGRvIHtcbiAgICBsci50aGV0YSA9IGdyYWRpZW50RGVzY2VudChidWNrZXQuZGF0YSxsci5hbHBoYSxsci50aGV0YSk7XG4gICAgbHIuakhpc3RvcnkucHVzaChKKGJ1Y2tldC5kYXRhLGxyLnRoZXRhKSk7XG4gICAgbHIudGhldGFIaXN0b3J5LnB1c2gobHIudGhldGEpO1xuICAgIGkrKztcbiAgfSB3aGlsZSAoZGlmZmVyZW5jZSgpID4gMC4wMDEpO1xuXG4gIHZhciBtYXhYID0gZDMubWF4KGJ1Y2tldC5kYXRhLHNwLnhWYWx1ZSk7XG4gIC8vIHZhciBtaW5YID0gZDMubWluKGJ1Y2tldC5kYXRhLHNwLnhWYWx1ZSk7XG4gIHZhciBtaW5YID0gMDtcbiAgc3Auc3ZnLnNlbGVjdEFsbChcImxpbmVcIikucmVtb3ZlKCk7XG4gIHZhciBsaW5lT2ZCZXN0Rml0ID0gc3Auc3ZnLmFwcGVuZChcImxpbmVcIilcbiAgICAuYXR0cih7XG4gICAgICB4MSA6IHNwLnhTY2FsZShtaW5YKSxcbiAgICAgIHkxIDogc3AueVNjYWxlKG1pblgqbHIudGhldGFbMV0gKyBsci50aGV0YVswXSksXG4gICAgICB4MiA6IHNwLnhTY2FsZShtYXhYKSxcbiAgICAgIHkyIDogc3AueVNjYWxlKG1heFgqbHIudGhldGFbMV0gKyBsci50aGV0YVswXSksXG4gICAgICBcInN0cm9rZVwiIDogXCIjMUNERUM0XCIsXG4gICAgICBcInN0cm9rZS13aWR0aFwiIDogMlxuICAgIH0pO1xuXG4gIC8vIGRpc3BsYXkgdGhlIGVxdWF0aW9uIGZvciB0aGUgbGluZSBvZiBiZXN0IGZpdFxuICB2YXIgZG9jRnJhZyA9IGRvY3VtZW50LmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKTtcbiAgdmFyIHAgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdQJyk7XG4gIGRvY0ZyYWcuYXBwZW5kQ2hpbGQocCk7XG4gIHZhciBwVGV4dCA9IGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKGB5ID0gJHtsci50aGV0YVsxXS50b1ByZWNpc2lvbigzKX14ICsgJHtsci50aGV0YVswXS50b1ByZWNpc2lvbigzKX1gKTtcbiAgcC5hcHBlbmRDaGlsZChwVGV4dCk7XG4gICQoXCIjZXF1YXRpb25cIikuZW1wdHkoKTtcbiAgJChcIiNlcXVhdGlvblwiKS5hcHBlbmQocCk7XG59O1xuYnVja2V0LnVwZGF0ZSgpO1xuXG4vLyBhZGRzIGEgbmV3LCByYW5kb21seSBnZW5lcmF0ZWQgZGF0dW0gdG8gZ3JhcGhcbmQzLnNlbGVjdChcIiNhZGRcIilcbiAgLm9uKFwiY2xpY2tcIiwgZnVuY3Rpb24oKSB7XG4gICAgdmFyIG5ld0RvdCA9IHt9O1xuICAgIG5ld0RvdC54ID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTAwKTtcbiAgICBuZXdEb3QueSA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDEwMCk7XG4gICAgYnVja2V0LmRhdGEucHVzaChuZXdEb3QpO1xuICAgIGJ1Y2tldC51cGRhdGUoKTtcbiAgfSk7XG5cbiJdfQ==
